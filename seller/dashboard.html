<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard — BizBoost</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Syne:wght@600;700;800&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#07091a;--bg1:#0a0d22;--bg2:#0d1228;--bg3:#131830;--bg4:#1a2040;
  --border:rgba(100,150,255,0.08);--border2:rgba(100,150,255,0.15);
  --text:#e8eaf6;--text2:rgba(232,234,246,0.6);--text3:rgba(232,234,246,0.32);
  --blue:#5585ff;--green:#22c55e;--orange:#f59e0b;--red:#ef4444;--purple:#a855f7;
  --nav-h:58px;--r:20px;--r-sm:14px;--ease:cubic-bezier(.22,1,.36,1);
  --glow-blue:0 0 32px rgba(85,133,255,0.25);
  --glow-purple:0 0 32px rgba(168,85,247,0.2);
  --card-shine:linear-gradient(180deg,rgba(100,150,255,0.06) 0%,transparent 60%);
}
html{scroll-behavior:smooth;-webkit-font-smoothing:antialiased}
body{
  font-family:'Inter',-apple-system,sans-serif;
  background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;
  background-image:
    radial-gradient(ellipse 120% 50% at 50% -5%, rgba(85,133,255,0.10) 0%, transparent 60%),
    radial-gradient(ellipse 60% 40% at 85% 15%, rgba(168,85,247,0.07) 0%, transparent 50%);
}
/* ANIMATED BG ORBS */
.bg-orb{position:fixed;border-radius:50%;pointer-events:none;z-index:0;filter:blur(80px);opacity:.35}
.bg-orb-1{width:600px;height:600px;top:-200px;left:-100px;background:radial-gradient(circle,rgba(85,133,255,0.3),transparent 70%);animation:orbFloat1 18s ease-in-out infinite}
.bg-orb-2{width:500px;height:500px;top:30%;right:-150px;background:radial-gradient(circle,rgba(168,85,247,0.25),transparent 70%);animation:orbFloat2 22s ease-in-out infinite}
.bg-orb-3{width:400px;height:400px;bottom:-100px;left:30%;background:radial-gradient(circle,rgba(34,197,94,0.12),transparent 70%);animation:orbFloat3 26s ease-in-out infinite}
@keyframes orbFloat1{0%,100%{transform:translate(0,0)}33%{transform:translate(60px,40px)}66%{transform:translate(-30px,60px)}}
@keyframes orbFloat2{0%,100%{transform:translate(0,0)}40%{transform:translate(-50px,30px)}70%{transform:translate(40px,-40px)}}
@keyframes orbFloat3{0%,100%{transform:translate(0,0)}30%{transform:translate(40px,-20px)}70%{transform:translate(-40px,30px)}}
/* SCROLL PROGRESS */
#prog{position:fixed;top:0;left:0;height:2px;width:0%;z-index:9999;
  background:linear-gradient(90deg,var(--blue),var(--purple),var(--blue));
  background-size:200%;animation:bgShift 2s linear infinite;transition:width .08s linear;
  box-shadow:0 0 12px rgba(85,133,255,0.8)}
@keyframes bgShift{0%{background-position:100%}100%{background-position:-100%}}
/* NAV */
.nav{position:sticky;top:0;z-index:200;height:var(--nav-h);
  display:flex;align-items:center;justify-content:space-between;gap:12px;padding:0 28px;
  background:rgba(7,9,26,0.85);backdrop-filter:saturate(180%) blur(28px);
  -webkit-backdrop-filter:saturate(180%) blur(28px);
  border-bottom:1px solid var(--border);box-shadow:0 1px 0 rgba(100,150,255,0.05)}
.logo{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;color:var(--text);
  text-decoration:none;letter-spacing:-0.04em;display:flex;align-items:center;gap:8px;flex-shrink:0}
.logo-mark{width:28px;height:28px;border-radius:8px;
  background:linear-gradient(135deg,var(--blue),var(--purple));
  display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:800;color:#fff;
  box-shadow:var(--glow-blue)}
.logo em{background:linear-gradient(90deg,var(--blue),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-style:normal}
.logo-dot{width:6px;height:6px;border-radius:50%;background:var(--blue);box-shadow:0 0 10px var(--blue);animation:pdot 2.5s ease-in-out infinite}
@keyframes pdot{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(.6)}}
.nav-tabs{display:flex;gap:2px;background:rgba(13,18,40,0.8);border-radius:12px;padding:4px;border:1px solid var(--border)}
.ntab{font-size:13px;font-weight:500;padding:6px 14px;border-radius:9px;text-decoration:none;
  color:var(--text2);transition:all .18s var(--ease);white-space:nowrap;border:none;background:transparent;cursor:pointer}
.ntab:hover{color:var(--text);background:rgba(100,150,255,0.1)}
.ntab.on{color:var(--blue);background:rgba(85,133,255,0.18);box-shadow:0 0 16px rgba(85,133,255,0.2)}
.nav-r{display:flex;gap:10px;align-items:center}
.nav-avatar{width:32px;height:32px;border-radius:50%;flex-shrink:0;cursor:pointer;
  background:linear-gradient(135deg,var(--blue),var(--purple));
  display:flex;align-items:center;justify-content:center;
  font-size:13px;font-weight:700;color:#fff;box-shadow:0 0 16px rgba(85,133,255,0.4);
  transition:transform .2s var(--ease),box-shadow .2s}
.nav-avatar:hover{transform:scale(1.08);box-shadow:0 0 24px rgba(85,133,255,0.6)}
.nav-logout{font-size:12.5px;font-weight:500;padding:6px 14px;border-radius:9px;
  background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.2);
  color:rgba(239,68,68,0.8);cursor:pointer;transition:all .18s var(--ease)}
.nav-logout:hover{background:rgba(239,68,68,0.18);color:var(--red);border-color:rgba(239,68,68,0.35)}
.burger{display:none;width:34px;height:34px;border-radius:9px;
  background:rgba(100,150,255,0.08);border:1px solid var(--border);
  align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;flex-direction:column;gap:5px;padding:8px}
.burger span{display:block;width:16px;height:1.5px;background:var(--text2);border-radius:2px;transition:all .2s}
.burger.open span:nth-child(1){transform:translateY(6.5px) rotate(45deg)}
.burger.open span:nth-child(2){opacity:0}
.burger.open span:nth-child(3){transform:translateY(-6.5px) rotate(-45deg)}
/* MOBILE DRAWER */
#mobDrawer{position:fixed;inset:0;z-index:500;background:rgba(7,9,26,0.97);
  backdrop-filter:blur(20px);transform:translateX(-100%);transition:transform .3s var(--ease);
  display:flex;flex-direction:column;padding:80px 28px 40px}
#mobDrawer.open{transform:translateX(0)}
.mob-nav-link{display:flex;align-items:center;gap:12px;padding:14px 0;
  font-size:16px;font-weight:600;color:var(--text2);text-decoration:none;
  border-bottom:1px solid var(--border);transition:color .18s}
.mob-nav-link:hover,.mob-nav-link.on{color:var(--text)}
.mob-logout{margin-top:24px;padding:14px 20px;border-radius:12px;
  background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.15);
  color:rgba(239,68,68,0.8);font-size:14px;font-weight:600;cursor:pointer;width:100%;text-align:left}
/* MAIN */
.main{position:relative;z-index:1;max-width:1320px;margin:0 auto;padding:32px 24px 60px}
/* BENTO GRID */
.bento{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
/* HERO */
.hero-cell{grid-column:1/-1;border-radius:24px;overflow:hidden;position:relative;
  background:rgba(255,255,255,0.02);border:1px solid rgba(100,150,255,0.12);
  backdrop-filter:blur(40px);box-shadow:var(--glow-blue),0 4px 60px rgba(0,0,0,0.5);
  animation:fadeUp .45s var(--ease) both}
.hero-cell::before{content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,rgba(85,133,255,0.07) 0%,rgba(168,85,247,0.05) 50%,transparent 100%);
  border-radius:inherit;pointer-events:none}
.hero-inner{display:grid;grid-template-columns:1fr auto;gap:0;min-height:220px}
.hero-left{padding:40px 44px;display:flex;flex-direction:column;justify-content:center;gap:16px}
.hero-eyebrow{font-size:12px;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;color:var(--blue);opacity:0.9}
.hero-name{font-family:'Syne',sans-serif;font-size:clamp(28px,3.5vw,46px);font-weight:800;
  line-height:1.08;letter-spacing:-0.03em;color:var(--text)}
.hero-sub{font-size:14px;color:var(--text2);max-width:420px;line-height:1.6}
.hero-actions{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:4px}
/* PLAN CHIP */
.plan-chip{display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border-radius:40px;
  border:1px solid var(--border2);background:rgba(13,18,40,0.8);cursor:default;transition:all .2s var(--ease)}
.plan-chip-icon{display:flex;align-items:center;opacity:.8}
.plan-chip-label{display:flex;flex-direction:column;gap:1px}
.plan-chip-name{font-size:12px;font-weight:700;line-height:1}
.plan-chip-sub{font-size:10px;color:var(--text3);line-height:1}
.plan-chip-free{border-color:rgba(100,150,255,0.15)}
.plan-chip-free .plan-chip-name{color:var(--text2)}
.plan-chip-basic{border-color:rgba(34,197,94,0.2)}
.plan-chip-basic .plan-chip-name{color:var(--green)}
.plan-chip-pro{border-color:rgba(168,85,247,0.3);background:rgba(168,85,247,0.06)}
.plan-chip-pro .plan-chip-name{color:var(--purple)}
.plan-chip-enterprise{border-color:rgba(245,158,11,0.3);background:rgba(245,158,11,0.06)}
.plan-chip-enterprise .plan-chip-name{color:var(--orange)}
/* RUN BTN */
.run-btn{position:relative;display:inline-flex;align-items:center;gap:10px;
  padding:13px 26px;border-radius:100px;font-size:14px;font-weight:700;
  color:#fff;border:none;cursor:pointer;overflow:visible;
  background:linear-gradient(135deg,var(--blue),var(--purple));
  box-shadow:0 0 32px rgba(85,133,255,0.45),0 4px 16px rgba(0,0,0,.4);
  transition:transform .2s var(--ease),box-shadow .2s;letter-spacing:.01em}
.run-btn:hover:not(:disabled){transform:scale(1.04);box-shadow:0 0 48px rgba(85,133,255,0.65),0 6px 20px rgba(0,0,0,.4)}
.run-btn:disabled{opacity:.55;cursor:not-allowed;transform:none}
.run-btn::before{content:'';position:absolute;inset:-3px;border-radius:inherit;
  background:linear-gradient(135deg,var(--blue),var(--purple),var(--blue));
  background-size:300%;z-index:-1;filter:blur(8px);opacity:.7;animation:btnOrbit 3s linear infinite}
@keyframes btnOrbit{0%{background-position:0%}100%{background-position:300%}}
/* KPI RINGS */
.hero-right{display:grid;grid-template-columns:repeat(2,1fr);gap:0;
  padding:24px 32px;align-items:center;position:relative}
.hero-right::before{content:'';position:absolute;left:0;top:16px;bottom:16px;
  width:1px;background:linear-gradient(180deg,transparent,rgba(100,150,255,0.15),transparent)}
.kpi-ring-wrap{display:flex;flex-direction:column;align-items:center;gap:8px;padding:16px 12px}
.kpi-ring-svg{position:relative;width:84px;height:84px;flex-shrink:0}
.kpi-ring-svg svg{position:absolute;top:0;left:0}
.kpi-ring-svg .kpi-val{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
  font-family:'Syne',sans-serif;font-size:17px;font-weight:800;color:var(--text)}
.kpi-label{font-size:11px;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:.06em;text-align:center}
/* CARDS */
.card{position:relative;border-radius:20px;overflow:hidden;
  background:var(--bg2);border:1px solid var(--border);
  transition:transform .18s var(--ease),box-shadow .18s;
  animation:fadeUp .5s var(--ease) both}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:60px;
  background:var(--card-shine);pointer-events:none;z-index:1;border-radius:inherit}
.card:hover{transform:translateY(-2px);box-shadow:0 8px 40px rgba(0,0,0,.4),0 0 0 1px rgba(100,150,255,0.12)}
@keyframes fadeUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
.card:nth-child(2){animation-delay:.06s}
.card:nth-child(3){animation-delay:.12s}
.card:nth-child(4){animation-delay:.18s}
.card:nth-child(5){animation-delay:.24s}
.card:nth-child(6){animation-delay:.30s}
/* CARD HEADER */
.ch{display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:18px 20px 14px;position:relative;z-index:2}
.ch h3{display:flex;align-items:center;gap:9px;font-size:14px;font-weight:700;color:var(--text);letter-spacing:-.01em}
.ch-icon{width:26px;height:26px;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.ch-icon.blue{background:rgba(85,133,255,0.15);color:var(--blue)}
.ch-icon.green{background:rgba(34,197,94,0.15);color:var(--green)}
.ch-icon.purple{background:rgba(168,85,247,0.15);color:var(--purple)}
.ch-icon.orange{background:rgba(245,158,11,0.15);color:var(--orange)}
.ctog{width:26px;height:26px;border-radius:8px;border:1px solid var(--border2);
  background:rgba(100,150,255,0.06);color:var(--text2);
  display:flex;align-items:center;justify-content:center;cursor:pointer;
  font-size:14px;transition:all .2s var(--ease);flex-shrink:0}
.ctog:hover{background:rgba(100,150,255,0.12);color:var(--text)}
.ctog.rotated{transform:rotate(180deg)}
.cb{padding:0 20px 20px;position:relative;z-index:2}
.hidden{display:none!important}
/* LAYOUT */
.row-analysis{grid-column:1/-1;display:grid;grid-template-columns:2fr 1fr;gap:20px}
#reportCard,#ctaBox{min-height:200px}
#reportCard{display:none}
#ctaBox{display:block}
.row-bottom{grid-column:1/-1;display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
/* LOADER */
#loaderBox{display:none;padding:20px}
.loader-box{display:flex;flex-direction:column;gap:24px}
.loader-progress{height:3px;border-radius:2px;background:rgba(255,255,255,0.06);overflow:hidden}
#lpf{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--blue),var(--purple));
  transition:width .8s var(--ease);width:0;box-shadow:0 0 12px rgba(85,133,255,0.5)}
.loader-steps{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.ls{display:flex;align-items:center;gap:7px;padding:8px 10px;border-radius:10px;
  background:rgba(100,150,255,0.04);border:1px solid transparent;
  font-size:12px;color:var(--text3);transition:all .3s var(--ease)}
.ls.active{border-color:rgba(85,133,255,0.3);background:rgba(85,133,255,0.1);color:var(--blue)}
.ls.done{border-color:rgba(34,197,94,0.2);background:rgba(34,197,94,0.06);color:var(--green)}
.ls-dot{width:7px;height:7px;border-radius:50%;background:currentColor;flex-shrink:0}
.ls.active .ls-dot{animation:pulseDot 1s infinite}
@keyframes pulseDot{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(.5)}}
#lstep{font-size:13px;color:var(--text2);margin-top:4px;transition:opacity .18s}
.lstep-txt{transition:opacity .18s}
.lstep-txt.fade{opacity:0}
/* CTA */
.cta-box{display:flex;flex-direction:column;align-items:center;gap:16px;padding:40px 24px;text-align:center}
.cta-orb{width:72px;height:72px;border-radius:50%;border:2px solid rgba(85,133,255,0.25);
  background:rgba(85,133,255,0.08);display:flex;align-items:center;justify-content:center;
  color:var(--blue);animation:orbPulse 2.5s ease-in-out infinite}
@keyframes orbPulse{0%,100%{box-shadow:0 0 0 0 rgba(85,133,255,0.3)}50%{box-shadow:0 0 0 16px rgba(85,133,255,0)}}
.cta-box h3{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;letter-spacing:-.02em}
.cta-box p{font-size:13.5px;color:var(--text2);max-width:320px;line-height:1.6}
.cta-btns{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
.cta-primary{padding:12px 28px;border-radius:100px;font-size:14px;font-weight:700;
  color:#fff;border:none;cursor:pointer;
  background:linear-gradient(135deg,var(--blue),var(--purple));
  box-shadow:0 0 24px rgba(85,133,255,0.35);transition:all .2s var(--ease)}
.cta-primary:hover{transform:scale(1.04);box-shadow:0 0 36px rgba(85,133,255,0.5)}
/* REPORT */
.report-head{padding:18px 20px 0;display:flex;align-items:center;justify-content:space-between;gap:8px;position:relative;z-index:2}
.report-head h3{font-size:14px;font-weight:700;color:var(--text);display:flex;align-items:center;gap:9px}
.report-meta{font-size:11px;color:var(--text3)}
.report-toggle-row{display:flex;align-items:center;gap:8px}
.rtabs{display:flex;gap:3px;background:rgba(100,150,255,0.05);border-radius:11px;padding:3px;
  border:1px solid var(--border);margin:12px 20px 0}
.rtab{font-size:12px;font-weight:600;padding:5px 12px;border-radius:8px;border:none;
  background:transparent;color:var(--text2);cursor:pointer;display:flex;align-items:center;gap:5px;
  transition:all .18s var(--ease);white-space:nowrap}
.rtab:hover{color:var(--text);background:rgba(100,150,255,0.1)}
.rtab.on{color:#fff;background:linear-gradient(135deg,rgba(85,133,255,0.4),rgba(168,85,247,0.3));
  box-shadow:0 0 16px rgba(85,133,255,0.2)}
.rpanel{padding:16px 20px 20px}
/* COMP */
.comp-hero{background:rgba(85,133,255,0.06);border:1px solid rgba(85,133,255,0.14);
  border-radius:14px;padding:16px;margin-bottom:14px}
.comp-hero-eyebrow{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.08em;
  color:var(--blue);margin-bottom:6px;display:flex;align-items:center;gap:5px}
.comp-hero-name{font-family:'Syne',sans-serif;font-size:20px;font-weight:800;letter-spacing:-.02em;margin-bottom:4px}
.comp-hero-tag{font-size:12px;color:var(--text2);margin-bottom:8px}
.comp-hero-why{font-size:13px;color:var(--text2);line-height:1.55;padding-top:8px;border-top:1px solid rgba(100,150,255,0.1)}
.vs-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.vs-card{border-radius:12px;padding:12px}
.vs-card.warn{background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.15)}
.vs-card.good{background:rgba(34,197,94,0.06);border:1px solid rgba(34,197,94,0.15)}
.vs-card-hd{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.06em;
  margin-bottom:8px;display:flex;align-items:center;gap:5px}
.vs-card.warn .vs-card-hd{color:var(--red)}
.vs-card.good .vs-card-hd{color:var(--green)}
.vs-item{display:flex;align-items:flex-start;gap:8px;margin-bottom:6px}
.vs-dot{width:5px;height:5px;border-radius:50%;background:currentColor;flex-shrink:0;margin-top:6px;opacity:.7}
.vs-card.warn .vs-dot{color:var(--red)}
.vs-card.good .vs-dot{color:var(--green)}
.vs-item p{font-size:12.5px;color:var(--text2);line-height:1.5}
/* BLOCKERS */
.block-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px}
.block-card{border-radius:12px;padding:14px;background:rgba(245,158,11,0.06);
  border:1px solid rgba(245,158,11,0.15);display:flex;flex-direction:column;gap:8px}
.block-icon{color:var(--orange);opacity:.8}
.block-text{font-size:13px;color:var(--text2);line-height:1.5}
/* ACTIONS */
.action-list{display:flex;flex-direction:column;gap:8px}
.action-step{display:flex;align-items:flex-start;gap:12px;padding:12px;border-radius:12px;
  background:rgba(100,150,255,0.04);border:1px solid var(--border)}
.action-num{width:24px;height:24px;border-radius:50%;flex-shrink:0;
  background:linear-gradient(135deg,var(--blue),var(--purple));
  display:flex;align-items:center;justify-content:center;
  font-family:'Syne',sans-serif;font-size:11px;font-weight:800;color:#fff}
.action-body{flex:1}
.action-text{font-size:13px;color:var(--text2);line-height:1.6}
/* KEYWORDS */
.kw-toolbar{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:12px}
.kw-hint{font-size:12px;color:var(--text3)}
.kw-copy-all{font-size:12px;font-weight:600;padding:6px 12px;border-radius:8px;
  background:rgba(85,133,255,0.1);border:1px solid rgba(85,133,255,0.2);
  color:var(--blue);cursor:pointer;display:flex;align-items:center;gap:5px;transition:all .18s}
.kw-copy-all:hover{background:rgba(85,133,255,0.18)}
.kw-copy-all.copied{background:rgba(34,197,94,0.1);border-color:rgba(34,197,94,0.2);color:var(--green)}
.tags{display:flex;flex-wrap:wrap;gap:7px}
.tag{display:inline-flex;align-items:center;gap:5px;padding:5px 11px;border-radius:100px;
  font-size:12px;font-weight:500;cursor:pointer;
  background:rgba(100,150,255,0.08);border:1px solid rgba(100,150,255,0.15);
  color:var(--text2);transition:all .18s var(--ease);user-select:none}
.tag:hover{background:rgba(85,133,255,0.18);color:var(--text);border-color:rgba(85,133,255,0.3)}
.tag.copied{background:rgba(34,197,94,0.1);border-color:rgba(34,197,94,0.25);color:var(--green)}
/* EMPTY */
.empty{display:flex;flex-direction:column;align-items:center;gap:10px;padding:32px 20px;color:var(--text3);text-align:center}
.ei{opacity:.35}
.empty p{font-size:13px;line-height:1.5}
/* PROFILE */
.prof-hero{margin-bottom:16px;padding:16px;border-radius:14px;
  background:linear-gradient(135deg,rgba(85,133,255,0.08),rgba(168,85,247,0.06));
  border:1px solid rgba(100,150,255,0.12)}
.prof-hero-name{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;letter-spacing:-.02em;margin-bottom:4px}
.prof-hero-meta{font-size:12px;color:var(--text2);line-height:1.5}
.prof-pct{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;font-size:12.5px;color:var(--text2)}
.prof-bar-wrap{height:5px;border-radius:3px;background:rgba(255,255,255,0.06);overflow:hidden;margin-bottom:16px}
.prof-bar{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--blue),var(--green));transition:width 1s var(--ease);width:0}
.pr{display:flex;align-items:center;justify-content:space-between;gap:8px;
  padding:9px 0;border-bottom:1px solid var(--border);font-size:13px}
.pr:last-of-type{border-bottom:none}
.plbl{color:var(--text3);font-size:12px;font-weight:500}
.pval{color:var(--text);font-weight:600;font-size:12.5px;text-align:right;max-width:60%}
.pval.empty{color:var(--text3);font-weight:400;font-style:italic}
/* COMPETITORS */
#compCard{display:none}
.ci{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--border)}
.ci:last-child{border-bottom:none}
.cirk{width:28px;height:28px;border-radius:50%;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;font-family:'Syne',sans-serif}
.cirk.r1{background:rgba(245,158,11,0.2);color:var(--orange);border:1.5px solid rgba(245,158,11,0.4)}
.cirk.r2{background:rgba(232,234,246,0.12);color:var(--text2);border:1.5px solid rgba(232,234,246,0.2)}
.cirk.r3{background:rgba(180,130,70,0.15);color:#cd7f32;border:1.5px solid rgba(180,130,70,0.3)}
.cirk.rx{background:rgba(100,150,255,0.1);color:var(--text3);border:1.5px solid var(--border2)}
.ci-name{font-size:13.5px;font-weight:600;margin-bottom:2px}
.ci-sub{font-size:11.5px;color:var(--text3);display:flex;align-items:center;gap:4px}
.comp-count-badge{font-size:12px;font-weight:700;padding:3px 10px;border-radius:100px;
  background:rgba(85,133,255,0.1);border:1px solid rgba(85,133,255,0.2);color:var(--blue)}
/* USAGE */
.usage-feat{display:flex;flex-direction:column;gap:12px}
.usage-row{padding:12px;border-radius:12px;background:rgba(100,150,255,0.04);border:1px solid var(--border)}
.usage-row-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.usage-feat-name{font-size:13px;font-weight:600;display:flex;align-items:center;gap:5px}
.usage-counts{font-size:12px;color:var(--text2);font-weight:500}
.usage-bar-wrap{height:5px;border-radius:3px;background:rgba(255,255,255,0.06);overflow:hidden;margin-bottom:4px}
.usage-bar-fill{height:100%;border-radius:3px;transition:width 1s var(--ease);width:0}
.usage-upgrade-hint{display:flex;align-items:flex-start;gap:9px;margin-top:12px;
  padding:10px 12px;border-radius:11px;background:rgba(245,158,11,0.07);
  border:1px solid rgba(245,158,11,0.15);font-size:12.5px;color:var(--orange);line-height:1.55}
.usage-tier-badge{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:100px;
  font-size:11px;font-weight:700;letter-spacing:.02em}
.usage-tier-free{background:rgba(100,150,255,0.1);border:1px solid rgba(100,150,255,0.2);color:var(--blue)}
.usage-tier-basic{background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.2);color:var(--green)}
.usage-tier-pro{background:rgba(168,85,247,0.1);border:1px solid rgba(168,85,247,0.25);color:var(--purple)}
.usage-tier-enterprise{background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.25);color:var(--orange)}
/* LEADS */
.li{padding:10px 0;border-bottom:1px solid var(--border)}
.li:last-child{border-bottom:none}
.li-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:4px}
.li-name{font-size:13.5px;font-weight:600;color:var(--text)}
.badge-g{font-size:10.5px;font-weight:700;padding:2px 8px;border-radius:100px;
  background:rgba(34,197,94,0.12);border:1px solid rgba(34,197,94,0.2);color:var(--green)}
.li-meta{font-size:12px;color:var(--text3);display:flex;align-items:center;gap:5px}
.va{display:flex;align-items:center;gap:6px;font-size:13px;font-weight:600;color:var(--blue);
  text-decoration:none;padding:12px 20px 16px;transition:gap .18s var(--ease)}
.va:hover .va-arr{transform:translateX(3px)}
.va-arr{transition:transform .18s var(--ease)}
/* RIPPLE */
.rpl{position:absolute;border-radius:50%;background:rgba(255,255,255,0.1);
  transform:scale(0);animation:rippleAnim .5s ease-out forwards;pointer-events:none}
@keyframes rippleAnim{to{transform:scale(2.5);opacity:0}}
/* TOAST */
.toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%) translateY(20px);
  background:rgba(13,18,40,0.95);backdrop-filter:blur(20px);
  border:1px solid var(--border2);border-radius:100px;padding:12px 22px;
  font-size:13.5px;font-weight:500;color:var(--text);
  z-index:8888;opacity:0;transition:all .3s var(--ease);
  box-shadow:0 8px 40px rgba(0,0,0,.5),0 0 0 1px rgba(100,150,255,0.1);
  pointer-events:none;display:flex;align-items:center;gap:8px;white-space:nowrap}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast.ok{border-color:rgba(34,197,94,0.3);color:var(--green)}
.toast.err{border-color:rgba(239,68,68,0.3);color:var(--red)}
/* MOBILE BOTTOM NAV */
.mob-bottom-nav{display:none;position:fixed;bottom:0;left:0;right:0;z-index:300;
  background:rgba(7,9,26,0.95);backdrop-filter:blur(24px);
  border-top:1px solid var(--border);
  padding:8px 0 16px;padding-bottom:calc(8px + env(safe-area-inset-bottom,8px));
  grid-template-columns:repeat(4,1fr)}
.mob-nav-item{display:flex;flex-direction:column;align-items:center;gap:4px;
  padding:8px 4px;cursor:pointer;text-decoration:none;color:var(--text3);
  font-size:10px;font-weight:600;letter-spacing:.02em;transition:color .18s;position:relative}
.mob-nav-item.on{color:var(--blue)}
.mob-nav-item.on::after{content:'';position:absolute;bottom:-4px;left:50%;transform:translateX(-50%);
  width:18px;height:2px;border-radius:2px;background:var(--blue)}
.mob-nav-icon{width:22px;height:22px}
@media(max-width:680px){
  .nav-tabs,.nav-logout{display:none}
  .burger{display:flex}
  .nav{padding:0 16px}
  .main{padding:20px 14px 90px;padding-bottom:calc(90px + env(safe-area-inset-bottom,0px))}
  .bento{grid-template-columns:1fr;gap:14px}
  .row-analysis{grid-template-columns:1fr}
  .row-bottom{grid-template-columns:1fr}
  .hero-inner{grid-template-columns:1fr;gap:0}
  .hero-left{padding:28px 24px 16px}
  .hero-right::before{display:none}
  .hero-right{grid-template-columns:repeat(2,1fr);padding:0 24px 28px;border-top:1px solid var(--border)}
  .mob-bottom-nav{display:grid}
  .profile-card{display:none}
  .loader-steps{grid-template-columns:repeat(2,1fr)}
  .vs-grid{grid-template-columns:1fr}
}
@media(min-width:681px){
  .mob-bottom-nav{display:none!important}
  .burger{display:none!important}
}
</style>
</head>
<body>
<div class="bg-orb bg-orb-1"></div>
<div class="bg-orb bg-orb-2"></div>
<div class="bg-orb bg-orb-3"></div>
<div id="prog"></div>

<div id="mobDrawer">
  <a href="../index.html" class="mob-nav-link">Home</a>
  <a href="dashboard.html" class="mob-nav-link on">Dashboard</a>
  <a href="leads.html" class="mob-nav-link">Leads</a>
  <a href="onboard.html" class="mob-nav-link">Edit Profile</a>
  <button class="mob-logout" id="mobLogout">Sign Out</button>
</div>

<nav class="nav">
  <a href="../index.html" class="logo">
    <div class="logo-mark">B</div>
    Biz<em>Boost</em>
    <span class="logo-dot"></span>
  </a>
  <div class="nav-tabs">
    <a href="dashboard.html" class="ntab on">Dashboard</a>
    <a href="leads.html" class="ntab">Leads</a>
    <a href="onboard.html" class="ntab">Profile</a>
  </div>
  <div class="nav-r">
    <div class="nav-avatar" id="navAvatar">?</div>
    <button class="nav-logout" id="logoutBtn">Sign out</button>
    <button class="burger" id="burgerBtn" onclick="toggleMob()">
      <span></span><span></span><span></span>
    </button>
  </div>
</nav>

<div class="main">
  <div class="bento">

    <div class="hero-cell">
      <div class="hero-inner">
        <div class="hero-left">
          <div class="hero-eyebrow">Seller Command Center</div>
          <h1 class="hero-name" id="wTitle">Welcome back</h1>
          <p class="hero-sub" id="wSub">Loading your business profile&#8230;</p>
          <div class="hero-actions">
            <span id="wTierBadge"></span>
            <button class="run-btn" id="topBtn" onclick="runResearch()">
              <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
              Run Analysis
            </button>
          </div>
        </div>
        <div class="hero-right">
          <div class="kpi-ring-wrap">
            <div class="kpi-ring-svg">
              <svg width="84" height="84" viewBox="0 0 84 84">
                <circle cx="42" cy="42" r="35" fill="none" stroke="rgba(85,133,255,0.12)" stroke-width="6"/>
                <circle cx="42" cy="42" r="35" fill="none" stroke="url(#gBlue)" stroke-width="6"
                  stroke-dasharray="219.9" stroke-dashoffset="165" stroke-linecap="round"
                  transform="rotate(-90 42 42)" style="transition:stroke-dashoffset 1.2s cubic-bezier(.22,1,.36,1)"/>
                <defs><linearGradient id="gBlue" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#5585ff"/><stop offset="100%" stop-color="#a855f7"/></linearGradient></defs>
              </svg>
              <div class="kpi-val" id="kpiComp">0</div>
            </div>
            <div class="kpi-label">Competitors</div>
          </div>
          <div class="kpi-ring-wrap">
            <div class="kpi-ring-svg">
              <svg width="84" height="84" viewBox="0 0 84 84">
                <circle cx="42" cy="42" r="35" fill="none" stroke="rgba(34,197,94,0.12)" stroke-width="6"/>
                <circle cx="42" cy="42" r="35" fill="none" stroke="url(#gGreen)" stroke-width="6"
                  stroke-dasharray="219.9" stroke-dashoffset="165" stroke-linecap="round"
                  transform="rotate(-90 42 42)" style="transition:stroke-dashoffset 1.2s cubic-bezier(.22,1,.36,1)"/>
                <defs><linearGradient id="gGreen" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#22c55e"/><stop offset="100%" stop-color="#5585ff"/></linearGradient></defs>
              </svg>
              <div class="kpi-val" id="kpiLeads">0</div>
            </div>
            <div class="kpi-label">Leads</div>
          </div>
          <div class="kpi-ring-wrap">
            <div class="kpi-ring-svg">
              <svg width="84" height="84" viewBox="0 0 84 84">
                <circle cx="42" cy="42" r="35" fill="none" stroke="rgba(168,85,247,0.12)" stroke-width="6"/>
                <circle cx="42" cy="42" r="35" fill="none" stroke="url(#gPurple)" stroke-width="6"
                  stroke-dasharray="219.9" stroke-dashoffset="165" stroke-linecap="round"
                  transform="rotate(-90 42 42)" style="transition:stroke-dashoffset 1.2s cubic-bezier(.22,1,.36,1)"/>
                <defs><linearGradient id="gPurple" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#a855f7"/><stop offset="100%" stop-color="#5585ff"/></linearGradient></defs>
              </svg>
              <div class="kpi-val" id="kpiKw">0</div>
            </div>
            <div class="kpi-label">Keywords</div>
          </div>
          <div class="kpi-ring-wrap">
            <div class="kpi-ring-svg">
              <svg width="84" height="84" viewBox="0 0 84 84">
                <circle cx="42" cy="42" r="35" fill="none" stroke="rgba(245,158,11,0.12)" stroke-width="6"/>
                <circle cx="42" cy="42" r="35" fill="none" stroke="url(#gOrange)" stroke-width="6"
                  stroke-dasharray="219.9" stroke-dashoffset="165" stroke-linecap="round"
                  transform="rotate(-90 42 42)" style="transition:stroke-dashoffset 1.2s cubic-bezier(.22,1,.36,1)"/>
                <defs><linearGradient id="gOrange" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#ef4444"/></linearGradient></defs>
              </svg>
              <div class="kpi-val" id="kpiCredits">0</div>
            </div>
            <div class="kpi-label">Credits Used</div>
          </div>
        </div>
      </div>
    </div>

    <div class="row-analysis" style="grid-column:1/-1">
      <div style="display:flex;flex-direction:column;gap:20px">

        <div class="card" id="ctaBox">
          <div class="cta-box">
            <div class="cta-orb">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            </div>
            <h3>AI Business Intelligence</h3>
            <p>Discover your local competitors, get keyword targets and a weekly action plan powered by Groq AI.</p>
            <div class="cta-btns">
              <button class="cta-primary" onclick="runResearch()">Run Analysis &#8594;</button>
            </div>
          </div>
        </div>

        <div class="card" id="loaderBox">
          <div class="ch">
            <h3><div class="ch-icon blue"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div>Analysing&#8230;</h3>
          </div>
          <div class="cb loader-box">
            <div class="loader-progress"><div id="lpf"></div></div>
            <div id="lstep" class="lstep-txt">Starting&#8230;</div>
            <div class="loader-steps">
              <div class="ls" id="ls0"><div class="ls-dot"></div><span>Profile</span></div>
              <div class="ls" id="ls1"><div class="ls-dot"></div><span>Maps Search</span></div>
              <div class="ls" id="ls2"><div class="ls-dot"></div><span>Competitors</span></div>
              <div class="ls" id="ls3"><div class="ls-dot"></div><span>Scoring</span></div>
              <div class="ls" id="ls4"><div class="ls-dot"></div><span>AI Prompt</span></div>
              <div class="ls" id="ls5"><div class="ls-dot"></div><span>Strategy</span></div>
            </div>
          </div>
        </div>

        <div class="card" id="reportCard">
          <div class="report-head">
            <h3><div class="ch-icon purple"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></div>AI Strategy Report</h3>
            <div class="report-toggle-row">
              <span class="report-meta" id="rTime"></span>
              <button class="ctog" id="togReport" onclick="toggleCb('reportBody','togReport')">&#9662;</button>
            </div>
          </div>
          <div id="reportBody"></div>
        </div>

      </div>

      <div class="card profile-card" style="align-self:start">
        <div class="ch">
          <h3><div class="ch-icon blue"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.828 2.828 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg></div>Business Profile</h3>
          <button class="ctog" id="togProfile" onclick="toggleCb('profilePanel','togProfile')">&#9662;</button>
        </div>
        <div class="cb" id="profilePanel">
          <div class="empty"><div class="ei"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity:.35"><path d="M17 3a2.828 2.828 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg></div><p>Loading&#8230;</p></div>
        </div>
      </div>
    </div>

    <div class="row-bottom" style="grid-column:1/-1">
      <div class="card" id="compCard">
        <div class="ch">
          <h3><div class="ch-icon orange"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 010-5H6"/><path d="M18 9h1.5a2.5 2.5 0 000-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.29 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.29 17 22"/><path d="M18 2H6v7a6 6 0 0012 0V2z"/></svg></div>Competitors</h3>
          <div style="display:flex;gap:8px;align-items:center;flex-shrink:0">
            <span class="comp-count-badge" id="compCount"></span>
            <button class="ctog" id="togComp" onclick="toggleCb('compPreview','togComp')">&#9662;</button>
          </div>
        </div>
        <div class="cb" id="compPreview">
          <div class="empty"><div class="ei"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity:.35"><path d="M18 2H6v7a6 6 0 0012 0V2z"/></svg></div><p>Run analysis to find competitors.</p></div>
        </div>
      </div>

      <div class="card" id="usageCard">
        <div class="ch">
          <h3><div class="ch-icon blue"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg></div>API Credits</h3>
          <div style="display:flex;gap:8px;align-items:center;flex-shrink:0">
            <span id="usageTierBadge"></span>
            <button class="ctog" id="togUsage" onclick="toggleCb('usagePanel','togUsage')">&#9662;</button>
          </div>
        </div>
        <div class="cb" id="usagePanel">
          <div class="empty"><div class="ei"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity:.35"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg></div><p>Loading usage&#8230;</p></div>
        </div>
      </div>

      <div class="card" id="leadsWrap">
        <div class="ch">
          <h3><div class="ch-icon green"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg></div>Buyer Leads</h3>
          <div style="display:flex;gap:8px;align-items:center;flex-shrink:0">
            <span id="leadsSub" style="font-size:12px;color:var(--text3)"></span>
            <button class="ctog" id="togLeads" onclick="toggleCb('leadsPreview','togLeads')">&#9662;</button>
          </div>
        </div>
        <div class="cb" id="leadsPreview">
          <div class="empty"><div class="ei"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity:.35"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg></div><p>No leads yet.</p></div>
        </div>
        <a href="leads.html" class="va">View all leads <span class="va-arr">&#8594;</span></a>
      </div>
    </div>

  </div>
</div>

<nav class="mob-bottom-nav">
  <a class="mob-nav-item on" href="dashboard.html">
    <svg class="mob-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
    Overview
  </a>
  <a class="mob-nav-item" href="#compCard">
    <svg class="mob-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 010-5H6"/><path d="M18 9h1.5a2.5 2.5 0 000-5H18"/><path d="M18 2H6v7a6 6 0 0012 0V2z"/></svg>
    Rivals
  </a>
  <a class="mob-nav-item" href="#reportCard">
    <svg class="mob-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 11-7.778 7.778 5.5 5.5 0 017.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
    Keywords
  </a>
  <a class="mob-nav-item" href="leads.html">
    <svg class="mob-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11L2 12v6a2 2 0 002 2h16a2 2 0 002-2v-6l-3.45-6.89A2 2 0 0016.76 4H7.24a2 2 0 00-1.79 1.11z"/></svg>
    Leads
  </a>
</nav>

<div class="toast" id="toast"></div>

<script>
// ── SVG ICON HELPER ──────────────────────────────────────────
const ICONS={
  'bar-chart':'<line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/>',
  'storefront':'<rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V11a4 4 0 00-8 0v10"/><path d="M2 7l2-5h16l2 5"/>',
  'trophy':'<path d="M6 9H4.5a2.5 2.5 0 010-5H6"/><path d="M18 9h1.5a2.5 2.5 0 000-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.29 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.29 17 22"/><path d="M18 2H6v7a6 6 0 0012 0V2z"/>',
  'package':'<line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/>',
  'key':'<path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 11-7.778 7.778 5.5 5.5 0 017.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/>',
  'credit-card':'<rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/>',
  'phone':'<path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 9.8a19.79 19.79 0 01-3.07-8.63A2 2 0 012 .82h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L6.09 8.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/>',
  'star':'<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>',
  'map-pin':'<path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/>',
  'dollar-sign':'<line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/>',
  'zap':'<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>',
  'alert-triangle':'<path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>',
  'clipboard':'<rect x="9" y="2" width="6" height="4" rx="1" ry="1"/><path d="M9 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2h-3"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/>',
  'check-circle':'<path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>',
  'check':'<polyline points="20 6 9 17 4 12"/>',
  'x-circle':'<circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>',
  'layout-grid':'<rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>',
  'compass':'<circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/>',
  'search':'<circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>',
  'inbox':'<polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11L2 12v6a2 2 0 002 2h16a2 2 0 002-2v-6l-3.45-6.89A2 2 0 0016.76 4H7.24a2 2 0 00-1.79 1.11z"/>',
  'edit-2':'<path d="M17 3a2.828 2.828 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>',
  'list':'<line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/>',
  'trending-up':'<polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/>',
  'robot':'<rect x="3" y="11" width="18" height="10" rx="2"/><path d="M12 3a2 2 0 00-2 2v6h4V5a2 2 0 00-2-2z"/><line x1="8" y1="16" x2="8.01" y2="16"/><line x1="16" y1="16" x2="16.01" y2="16"/>',
  'refresh-cw':'<path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>',
  'gem':'<polygon points="6 3 18 3 22 9 12 22 2 9"/><polyline points="2 9 6 3 12 9 18 3 22 9"/><line x1="12" y1="22" x2="12" y2="9"/>',
  'circle':'<circle cx="12" cy="12" r="10"/>',
  'crown':'<path d="M2 4l3 12h14l3-12-6 7-4-7-4 7-6-7z"/><path d="M5 20h14"/>',
};
function icon(name,size=16){
  return `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block;vertical-align:middle;flex-shrink:0">${ICONS[name]||''}</svg>`;
}
const API="/api";
let seller=JSON.parse(localStorage.getItem("seller")||"null");
let details=JSON.parse(localStorage.getItem("sellerDetails")||"{}");
if(!seller?.id)location.href="register.html";

/* SCROLL PROGRESS */
window.addEventListener("scroll",()=>{
  const s=window.scrollY,h=document.documentElement.scrollHeight-innerHeight;
  if(h>0)document.getElementById("prog").style.width=(s/h*100)+"%";
},{passive:true});

/* KPI MOUSE GLOW */
document.querySelectorAll(".kpi").forEach(el=>{
  el.addEventListener("mousemove",e=>{
    const r=el.getBoundingClientRect();
    el.style.setProperty("--mx",((e.clientX-r.left)/r.width*100)+"%");
    el.style.setProperty("--my",((e.clientY-r.top)/r.height*100)+"%");
  });
});

/* RIPPLE */
function ripple(e,el){
  const r=document.createElement("span"),rect=el.getBoundingClientRect();
  const sz=Math.max(rect.width,rect.height);
  r.className="rpl";
  r.style.cssText=`width:${sz}px;height:${sz}px;left:${e.clientX-rect.left-sz/2}px;top:${e.clientY-rect.top-sz/2}px`;
  el.appendChild(r);r.addEventListener("animationend",()=>r.remove());
}

/* JUMP TO SECTION */
function jumpTo(id){
  const el=document.getElementById(id);
  if(!el||el.style.display==="none")return;
  el.scrollIntoView({behavior:"smooth",block:"start"});
  const orig=el.style.boxShadow;
  el.style.transition="box-shadow .4s";
  el.style.boxShadow="0 0 0 2px rgba(41,151,255,.5)";
  setTimeout(()=>{el.style.boxShadow=orig||""},1200);
}

/* MOBILE NAV */
function toggleMob(){
  const d=document.getElementById("mobDrawer"),b=document.getElementById("burgerBtn");
  d.classList.toggle("open");b.classList.toggle("open");
  document.body.style.overflow=d.classList.contains("open")?"hidden":"";
}
function closeMob(){
  document.getElementById("mobDrawer").classList.remove("open");
  document.getElementById("burgerBtn").classList.remove("open");
  document.body.style.overflow="";
}

/* COLLAPSIBLE */
function toggleCb(cbId,btnId){
  const cb=document.getElementById(cbId),btn=document.getElementById(btnId);
  cb.classList.toggle("hidden");btn.classList.toggle("rotated");
}

/* TOAST */
let _toastTid;
function toast(msg,dur=3500,type=""){
  const t=document.getElementById("toast");
  t.innerHTML=msg;t.className="toast show"+(type?" "+type:"");
  clearTimeout(_toastTid);
  _toastTid=setTimeout(()=>t.classList.remove("show"),dur);
}

/* ANIMATED COUNTER */
function animCount(el,target){
  if(!el)return;
  const n=parseInt(target)||0;
  if(n===0){el.textContent="0";return}
  let cur=0;const dur=700,frames=40,inc=n/frames;
  const t=setInterval(()=>{
    cur=Math.min(cur+inc,n);el.textContent=Math.round(cur);
    if(cur>=n)clearInterval(t);
  },dur/frames);
}

function esc(s){return(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}

/* AUTH */
function doLogout(){localStorage.clear();location.href="../index.html"}
document.getElementById("logoutBtn").addEventListener("click",doLogout);
document.getElementById("mobLogout").addEventListener("click",doLogout);

/* WELCOME */
function initWelcome(){
  seller=JSON.parse(localStorage.getItem("seller")||"{}");
  details=JSON.parse(localStorage.getItem("sellerDetails")||"{}");
  const name=seller.name?.split(" ")[0]||"there";
  document.getElementById("wTitle").textContent="Welcome back, "+name;
  document.getElementById("wSub").textContent=
    [(seller.city||""),(seller.state||"")].filter(Boolean).join(", ")+(seller.category?" · "+seller.category:"");
  const av=document.getElementById("navAvatar");
  if(av)av.textContent=(seller.name||"?").charAt(0).toUpperCase();
}
initWelcome();

/* PROFILE */
function renderProfile(){
  seller=JSON.parse(localStorage.getItem("seller")||"{}");
  details=JSON.parse(localStorage.getItem("sellerDetails")||"{}");
  const allRows=[
    ["Business",seller.name],["Category",seller.category],["Type",details.business_type],
    ["City",seller.city],["State",seller.state],["Phone",seller.contact],
    ["GST",details.gst_number],["Employees",details.employees],
    ["Turnover",details.annual_turnover],["Website",seller.website],
  ];
  const filled=allRows.filter(r=>r[1]).length;
  const pct=Math.round(filled/allRows.length*100);
  const pctColor=pct<60?"var(--orange)":"var(--green)";

  let h=`<div class="prof-hero">
    <div class="prof-hero-name">${esc(seller.name||"Your Business")}</div>
    <div class="prof-hero-meta">${[seller.category,seller.city,seller.state].filter(Boolean).join(" · ")||"No details yet"}</div>
  </div>
  <div class="prof-pct">
    <span>Profile completeness</span>
    <span style="color:${pctColor};font-weight:700">${pct}%</span>
  </div>
  <div class="prof-bar-wrap"><div class="prof-bar" id="profBar"></div></div>`;

  const keyFields=[["Phone",seller.contact],["Website",seller.website],["Employees",details.employees],["Turnover",details.annual_turnover]].filter(([,v])=>v).slice(0,3);
  keyFields.forEach(([l,v])=>{
    h+=`<div class="pr"><span class="plbl">${esc(l)}</span><span class="pval">${esc(v)}</span></div>`;
  });
  if(!keyFields.length&&pct<40){
    h+=`<div class="pr"><span class="plbl">Type</span><span class="pval empty">${esc(details.business_type||"Not added")}</span></div>`;
  }
  if(pct<60){
    h+=`<div style="margin-top:12px;background:rgba(255,159,10,.07);
        border:1px solid rgba(255,159,10,.15);border-radius:10px;
        padding:10px 12px;font-size:12.5px;color:var(--orange);line-height:1.55;display:flex;align-items:center;gap:7px">
      ${icon('alert-triangle',13)} <span>Add more details for better analysis. <a href="onboard.html" style="color:var(--orange);font-weight:700">Complete →</a></span>
    </div>`;
  }
  document.getElementById("profilePanel").innerHTML=h;
  setTimeout(()=>{const b=document.getElementById("profBar");if(b)b.style.width=pct+"%"},120);
}
renderProfile();

/* COMPETITORS */
function renderCompPreview(comps){
  if(!comps?.length)return;
  document.getElementById("compCard").style.display="block";
  document.getElementById("compCount").textContent=comps.length+" found";
  document.getElementById("compPreview").innerHTML=comps.slice(0,5).map((c,i)=>{
    const cls=["r1","r2","r3","rx","rx"][i]||"rx";
    return `<div class="ci">
      <div class="cirk ${cls}">${i+1}</div>
      <div style="min-width:0">
        <div class="ci-name">${esc(c.name)}</div>
        <div class="ci-sub">${c.rating?`${icon('star',11)} ${c.rating} (${c.reviews})`:""} ${c.phone?`· ${icon('phone',11)} ${esc(c.phone)}`:""}</div>
      </div>
    </div>`;
  }).join("");
}

/* LEADS */
async function loadLeads(){
  try{
    const s=JSON.parse(localStorage.getItem("seller")||"{}");
    const r=await fetch(`${API}/get_leads.php?seller_id=${s.id}&category=${encodeURIComponent(s.category||"")}&city=${encodeURIComponent(s.city||"")}`);
    const d=await r.json();
    if(!d.success||!d.leads?.length){document.getElementById("leadsSub").textContent="No leads yet";return}
    animCount(document.getElementById("kpiLeads"),d.leads.length);
    document.getElementById("leadsSub").textContent=d.leads.length+" active";
    document.getElementById("leadsPreview").innerHTML=d.leads.slice(0,3).map(l=>`
      <div class="li">
        <div class="li-top">
          <span class="li-name">${esc(l.product)}</span>
          <span class="badge-g">Active</span>
        </div>
        <div class="li-meta">${icon('map-pin',11)} ${esc(l.city)} · ${icon('dollar-sign',11)} ${l.budget_max>0?`₹${Number(l.budget_min).toLocaleString("en-IN")}–₹${Number(l.budget_max).toLocaleString("en-IN")}`:"Budget N/A"}</div>
      </div>`).join("");
  }catch(e){}
}
loadLeads();

/* COPY TAG */
function copyTag(el,text){
  navigator.clipboard?.writeText(text).then(()=>{
    const orig=el.innerHTML;
    el.classList.add("copied");el.innerHTML=icon('check',12)+' Copied';
    setTimeout(()=>{el.classList.remove("copied");el.innerHTML=orig},1800);
  }).catch(()=>toast("Clipboard not available",2000));
}

/* REPORT */
let _kwList=[];

function switchRTab(id){
  document.querySelectorAll('.rtab').forEach(t=>t.classList.toggle('on',t.dataset.tab===id));
  document.querySelectorAll('.rpanel').forEach(p=>{p.style.display=p.dataset.panel===id?'':'none'});
}

function copyAllKeywords(el){
  const text=_kwList.join(', ');
  navigator.clipboard?.writeText(text).then(()=>{
    const orig=el.innerHTML;
    el.classList.add('copied');el.innerHTML=icon('check',12)+' All copied!';
    setTimeout(()=>{el.classList.remove('copied');el.innerHTML=orig},2000);
  }).catch(()=>toast("Clipboard not available",2000));
}

function renderReport(s){
  if(!s)return;
  document.getElementById("reportCard").style.display="block";
  document.getElementById("ctaBox").style.display="none";
  _kwList=s.keyword_targets||[];
  const tc=s.top_competitor;
  const tabs=[];const panels={};

  if(tc?.name){
    tabs.push({id:'comp',icon:'trophy',label:'Competitor'});
    let h=`<div class="comp-hero">
      <div class="comp-hero-eyebrow">${icon('trophy',10)} Top Local Competitor</div>
      <div class="comp-hero-name">${esc(tc.name)}</div>
      <div class="comp-hero-tag">Currently winning your local market</div>
      ${tc.why_winning?`<div class="comp-hero-why">${esc(tc.why_winning)}</div>`:''}
    </div>`;
    const hasStr=(tc.their_strengths||[]).length;
    const hasBeat=(tc.how_to_beat_them||[]).length;
    if(hasStr||hasBeat){
      h+=`<div class="vs-grid">`;
      if(hasStr){
        h+=`<div class="vs-card warn"><div class="vs-card-hd">${icon('zap',10)} Their Edge</div>`;
        h+=tc.their_strengths.map(t=>`<div class="vs-item"><div class="vs-dot"></div><p>${esc(t)}</p></div>`).join("");
        h+=`</div>`;
      }
      if(hasBeat){
  h+=`<div class="vs-card good"><div class="vs-card-hd">${icon('compass',10)} How to Win</div>`;
        h+=tc.how_to_beat_them.map(t=>`<div class="vs-item"><div class="vs-dot"></div><p>${esc(t)}</p></div>`).join("");
        h+=`</div>`;
      }
      h+=`</div>`;
    }
    panels['comp']=h;
  }

  if((s.bottlenecks||[]).length){
    tabs.push({id:'block',icon:'alert-triangle',label:'Blockers'});
    panels['block']='<div class="block-grid">'+s.bottlenecks.map(b=>
      `<div class="block-card"><div class="block-icon">${icon('alert-triangle',16)}</div><p class="block-text">${esc(b)}</p></div>`
    ).join("")+'</div>';
  }

  if((s.weekly_actions||[]).length){
    tabs.push({id:'act',icon:'list',label:'Actions'});
    panels['act']='<div class="action-list">'+s.weekly_actions.map((a,i)=>
      `<div class="action-step">
        <div class="action-num">${i+1}</div>
        <div class="action-body"><p class="action-text">${esc(a)}</p></div>
      </div>`
    ).join("")+'</div>';
  }

  if(_kwList.length){
    tabs.push({id:'kw',icon:'key',label:'Keywords'});
    panels['kw']=`<div class="kw-toolbar">
      <span class="kw-hint">${_kwList.length} targets — tap to copy</span>
      <button class="kw-copy-all" onclick="copyAllKeywords(this)">${icon('clipboard',12)} Copy all</button>
    </div>
    <div class="tags">`+_kwList.map(k=>`<span class="tag" onclick="copyTag(this,'${esc(k)}')">${esc(k)}</span>`).join("")+`</div>`;
  }

  if(!tabs.length){
    document.getElementById("reportBody").innerHTML=`<div class="empty" style="padding:32px"><div class="ei">${icon('robot',28)}</div><p>Re-run analysis to generate strategy.</p></div>`;
    return;
  }

  const firstId=tabs[0].id;
  let html='<div class="rtabs">';
  html+=tabs.map(t=>`<button class="rtab${t.id===firstId?' on':''}" data-tab="${t.id}" onclick="switchRTab('${t.id}')">${icon(t.icon,11)} ${t.label}</button>`).join("");
  html+='</div>';
  html+=tabs.map(t=>`<div class="rpanel" data-panel="${t.id}"${t.id!==firstId?' style="display:none"':''}>${panels[t.id]||''}</div>`).join("");
  document.getElementById("reportBody").innerHTML=html;
}

/* LOADER STEP FADE */
function setStep(txt){
  const el=document.getElementById("lstep");
  el.classList.add("fade");
  setTimeout(()=>{el.textContent=txt;el.classList.remove("fade")},180);
}

/* RUN ANALYSIS */
async function runResearch(){
  seller=JSON.parse(localStorage.getItem("seller")||"null");
  if(!seller)location.href="register.html";
  document.getElementById("ctaBox").style.display="none";
  document.getElementById("reportCard").style.display="none";
  document.getElementById("compCard").style.display="none";
  document.getElementById("loaderBox").style.display="block";
  document.getElementById("topBtn").disabled=true;
  const lsEls=["ls0","ls1","ls2","ls3","ls4","ls5"];
  lsEls.forEach(id=>{const e=document.getElementById(id);if(e)e.className="ls"});
  document.getElementById("lpf").style.width="0";

  const det=JSON.parse(localStorage.getItem("sellerDetails")||"{}");
  const prod1=(det.products_offered||"").split(",")[0]?.trim()||"your products";
  const steps=[
    [10,"Reading business profile…"],
    [22,`Searching Maps for "${prod1}"…`],
    [38,"Finding local competitors…"],
    [54,"Scoring and ranking…"],
    [68,"Building AI prompt…"],
    [82,"Groq AI generating plan…"],
    [94,"Saving report…"],
  ];
  let si=0;
  const tick=setInterval(()=>{
    if(si<steps.length){
      setStep(steps[si][1]);
      document.getElementById("lpf").style.width=steps[si][0]+"%";
      if(si>0){const p=document.getElementById(lsEls[si-1]);if(p){p.classList.remove("active");p.classList.add("done")}}
      const cur=document.getElementById(lsEls[si]);if(cur)cur.classList.add("active");
      si++;
    }
  },3200);

  try{
    const res=await fetch(`${API}/seller_research.php`,{method:"POST",
      headers:{"Content-Type":"application/json"},body:JSON.stringify({seller_id:seller.id})});
    const text=await res.text();
    clearInterval(tick);
    document.getElementById("lpf").style.width="100%";
    lsEls.forEach(id=>{const e=document.getElementById(id);if(e){e.classList.remove("active");e.classList.add("done")}});
    if(!res.ok)throw new Error(`HTTP ${res.status}: ${text.substring(0,100)}`);
    let data;try{data=JSON.parse(text)}catch(e){throw new Error("Non-JSON: "+text.substring(0,150))}
    if(!data.success)throw new Error(data.error||"Analysis failed");
    if(!data.strategy||!Object.keys(data.strategy).length)throw new Error("Empty strategy.");
    const now=new Date().toLocaleString("en-IN",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});
    localStorage.setItem("lastReport",JSON.stringify({strategy:data.strategy,competitors:data.competitors,top_competitor:data.top_competitor,timestamp:now}));
    animCount(document.getElementById("kpiComp"),data.counts?.competitors||(data.competitors||[]).length);
    animCount(document.getElementById("kpiKw"),data.counts?.keywords||(data.strategy.keyword_targets||[]).length);
    document.getElementById("rTime").textContent="Last run: "+now;
    renderReport(data.strategy);
    renderCompPreview(data.competitors||[]);
    toast(`${icon('check-circle',14)} Analysis complete!`,3500,"ok");
    loadUsage();
  }catch(err){
    clearInterval(tick);
    document.getElementById("loaderBox").style.display="none";
    document.getElementById("ctaBox").style.display="block";
    document.getElementById("ctaBox").innerHTML=`<div class="cta-box">
      <div class="cta-orb" style="background:rgba(255,69,58,.1);border-color:rgba(255,69,58,.2);animation:none">${icon('alert-triangle',24)}</div>
      <h3>Analysis Failed</h3>
      <p style="color:var(--red)">${esc(err.message)}</p>
      <div class="cta-btns"><button class="cta-primary" onclick="runResearch()">Retry →</button></div>
    </div>`;
    toast(`${icon('x-circle',14)} `+esc(err.message),6000,"err");
  }finally{
    document.getElementById("loaderBox").style.display="none";
    document.getElementById("topBtn").disabled=false;
  }
}

/* USAGE */
async function loadUsage(){
  const s=JSON.parse(localStorage.getItem("seller")||"{}");
  if(!s.id)return;
  try{
    const r=await fetch(`${API}/seller-usage.php?seller_id=${s.id}`);
    const d=await r.json();
    if(!d.success)return;
    renderUsage(d);
  }catch(e){}
}

function renderUsage(d){
  const tier=d.tier||"free";
  const limits=d.limits||{free:2,basic:10,pro:30,enterprise:-1};
  const usage=d.usage||[];
  const limit=limits[tier];
  const tierLabels={free:"Free",basic:"Basic",pro:"Pro",enterprise:"Enterprise"};
  const tierBadgeClass={free:"usage-tier-free",basic:"usage-tier-basic",pro:"usage-tier-pro",enterprise:"usage-tier-enterprise"};
  const tierIcons={free:icon('circle',11),basic:icon('circle',11),pro:icon('gem',11),enterprise:icon('crown',11)};
  const chipIcons={free:icon('circle',18),basic:icon('zap',18),pro:icon('gem',18),enterprise:icon('crown',18)};
  const chipClass={free:"plan-chip-free",basic:"plan-chip-basic",pro:"plan-chip-pro",enterprise:"plan-chip-enterprise"};

  const badgeEl=document.getElementById("usageTierBadge");
  const wTierEl=document.getElementById("wTierBadge");
  const badgeHtml=`<span class="usage-tier-badge ${tierBadgeClass[tier]||'usage-tier-free'}">${tierIcons[tier]||''} ${tierLabels[tier]||tier}</span>`;
  if(badgeEl)badgeEl.innerHTML=badgeHtml;
  if(wTierEl)wTierEl.innerHTML=`<div class="plan-chip ${chipClass[tier]||'plan-chip-free'}">
    <span class="plan-chip-icon">${chipIcons[tier]||chipIcons.free}</span>
    <span class="plan-chip-label">
      <span class="plan-chip-name">${tierLabels[tier]||tier}</span>
      <span class="plan-chip-sub">Current Plan</span>
    </span>
  </div>`;

  const featureNames={analyze:`${icon('search',13)} Analyze`,competitor_intel:`${icon('compass',13)} Competitor Intel`};
  const features=["analyze","competitor_intel"];
  let totalUsedThisMonth=0;
  let totalLimit=0;

  let html='<div class="usage-feat">';
  features.forEach(feat=>{
    const row=usage.find(u=>u.feature===feat)||{this_month:0,total:0};
    const used=parseInt(row.this_month||0);
    totalUsedThisMonth+=used;
    const pct=limit&&limit!==-1?Math.min(100,Math.round(used/limit*100)):0;
    const barColor=pct>=100?"var(--red)":pct>=80?"var(--orange)":"var(--blue)";
    if(limit!==-1)totalLimit+=limit;
    html+=`<div class="usage-row">
      <div class="usage-row-top">
        <span class="usage-feat-name">${featureNames[feat]||feat}</span>
        <span class="usage-counts">${used}${limit&&limit!==-1?" / "+limit:""} this month</span>
      </div>
      ${limit&&limit!==-1?`<div class="usage-bar-wrap"><div class="usage-bar-fill" id="ubar-${feat}" style="background:${barColor};width:0%"></div></div>`
        :`<div style="font-size:11px;color:var(--green);display:flex;align-items:center;gap:5px">${icon('check-circle',11)} Unlimited</div>`}
      <div style="margin-top:6px;font-size:11px;color:var(--text3)">${row.total||0} total all-time</div>
    </div>`;
  });
  html+='</div>';

  if(limit&&limit!==-1&&totalLimit>0){
    const overallPct=Math.round(totalUsedThisMonth/totalLimit*100);
    if(overallPct>=80){
      html+=`<div class="usage-upgrade-hint">${icon('alert-triangle',14)}<div>You've used <strong>${overallPct}%</strong> of your monthly credits. ${overallPct>=100?'<strong>Upgrade to continue using features.</strong>':'Consider upgrading for more.'}</div></div>`;
    }
  }

  document.getElementById("usagePanel").innerHTML=html;

  setTimeout(()=>{
    features.forEach(feat=>{
      const row=usage.find(u=>u.feature===feat)||{this_month:0,total:0};
      const used=parseInt(row.this_month||0);
      const pct=limit&&limit!==-1?Math.min(100,Math.round(used/limit*100)):0;
      const el=document.getElementById("ubar-"+feat);
      if(el)el.style.width=pct+"%";
    });
  },80);

  animCount(document.getElementById("kpiCredits"),totalUsedThisMonth);
}

/* INIT */
window.addEventListener("DOMContentLoaded",()=>{
  const p=new URLSearchParams(location.search);
  if(p.get("analyse")==="1"){
    history.replaceState({},"","dashboard.html");
    localStorage.removeItem("lastReport");
    initWelcome();renderProfile();
    toast(`${icon('check-circle',14)} Profile saved — running analysis…`,3000,"ok");
    setTimeout(runResearch,800);
  }else{
    const cached=JSON.parse(localStorage.getItem("lastReport")||"null");
    if(cached?.strategy){
      renderReport(cached.strategy);
      renderCompPreview(cached.competitors||[]);
      animCount(document.getElementById("kpiComp"),(cached.competitors||[]).length);
      animCount(document.getElementById("kpiKw"),(cached.strategy.keyword_targets||[]).length);
      if(cached.timestamp)document.getElementById("rTime").textContent="Last run: "+cached.timestamp;
    }
  }
  loadUsage();
});
</script>
</body>
</html>
