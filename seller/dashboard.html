<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard — BizBoost</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=Syne:wght@700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#05050a;--bg1:#09090f;--bg2:#0f0f18;
  --border:rgba(255,255,255,0.07);--border-m:rgba(255,255,255,0.04);
  --text:#eeeef5;--text2:rgba(238,238,245,0.52);--text3:rgba(238,238,245,0.22);
  --blue:#4da6ff;--green:#3dd68c;--orange:#ffb340;--red:#ff5a52;--purple:#c084fc;--cyan:#22d3ee;
  --nav-h:50px;--ease:cubic-bezier(.22,1,.36,1);
}
html{-webkit-font-smoothing:antialiased;scroll-behavior:smooth}
body{
  font-family:'Inter',-apple-system,sans-serif;
  background:var(--bg);color:var(--text);min-height:100vh;
  /* Dot grid */
  background-image:radial-gradient(rgba(255,255,255,.06) 1px,transparent 1px);
  background-size:28px 28px;
}

/* ── SCROLL PROGRESS ── */
#prog{position:fixed;top:0;left:0;height:1.5px;width:0%;z-index:9999;
  background:linear-gradient(90deg,var(--blue),var(--purple),var(--cyan));
  transition:width .06s linear}

/* ── NAVIGATION ── */
.nav{position:sticky;top:0;z-index:200;height:var(--nav-h);
  display:flex;align-items:center;justify-content:space-between;gap:16px;
  padding:0 28px;
  background:rgba(5,5,10,.88);backdrop-filter:saturate(160%) blur(24px);
  -webkit-backdrop-filter:saturate(160%) blur(24px);
  border-bottom:1px solid var(--border)}
.logo{font-family:'Syne',sans-serif;font-size:15px;font-weight:800;color:var(--text);
  text-decoration:none;letter-spacing:-0.04em;display:flex;align-items:center;gap:8px;flex-shrink:0}
.logo-mark{width:20px;height:20px;border-radius:3px;background:var(--blue);flex-shrink:0;
  display:flex;align-items:center;justify-content:center}
.logo em{color:var(--blue);font-style:normal}
.nav-tabs{display:flex;gap:0}
.ntab{font-size:12px;font-weight:500;padding:6px 13px;text-decoration:none;
  color:var(--text3);transition:color .15s;white-space:nowrap;letter-spacing:.01em}
.ntab:hover{color:var(--text2)}
.ntab.on{color:var(--text)}
.nav-r{display:flex;gap:8px;align-items:center}
.nav-avatar{width:26px;height:26px;border-radius:50%;flex-shrink:0;cursor:pointer;
  background:linear-gradient(135deg,var(--blue),var(--purple));
  display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:#fff}
.nbtn{font-size:12px;font-weight:500;padding:5px 13px;border-radius:3px;
  border:1px solid var(--border);background:transparent;color:var(--text3);
  cursor:pointer;text-decoration:none;transition:all .15s;font-family:inherit}
.nbtn:hover{background:rgba(255,255,255,.06);color:var(--text);border-color:rgba(255,255,255,.12)}
.nbtn.blue{background:var(--blue);color:#000;border-color:transparent;font-weight:700}
.nbtn.blue:hover{background:#6ab8ff}
.nbtn:disabled{opacity:.35;cursor:not-allowed}
.burger{display:none;flex-direction:column;gap:4px;cursor:pointer;
  padding:5px;border:none;background:none;border-radius:3px}
.burger span{display:block;width:18px;height:1.5px;background:var(--text3);
  transition:all .25s var(--ease);transform-origin:center}
.burger.open span:nth-child(1){transform:translateY(5.5px) rotate(45deg)}
.burger.open span:nth-child(2){opacity:0;transform:scaleX(0)}
.burger.open span:nth-child(3){transform:translateY(-5.5px) rotate(-45deg)}

/* ── MOBILE DRAWER ── */
.mob-drawer{position:fixed;inset:0;z-index:190;pointer-events:none}
.mob-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.75);opacity:0;
  transition:opacity .28s;pointer-events:none}
.mob-panel{position:absolute;top:var(--nav-h);left:0;right:0;
  background:rgba(5,5,10,.98);border-bottom:1px solid var(--border);
  padding:14px 18px 20px;transform:translateY(-8px);opacity:0;
  transition:all .25s var(--ease);pointer-events:none}
.mob-drawer.open .mob-backdrop{opacity:1;pointer-events:all}
.mob-drawer.open .mob-panel{transform:translateY(0);opacity:1;pointer-events:all}
.mob-links{display:flex;flex-direction:column;gap:2px;margin-bottom:12px}
.mob-link{font-size:14px;font-weight:500;padding:10px 12px;border-radius:3px;
  text-decoration:none;color:var(--text2);transition:all .15s;display:block}
.mob-link:hover,.mob-link.on{color:var(--text);background:rgba(255,255,255,.05)}
.mob-actions{display:flex;gap:8px}

/* ── PAGE WRAPPER ── */
.wrap{max-width:1320px;margin:0 auto;padding:0 28px 80px}

/* ── HERO ── */
.hero{
  display:flex;align-items:center;justify-content:space-between;gap:24px;
  padding:36px 0 30px;
  border-bottom:1px solid var(--border);
  animation:fadeUp .38s var(--ease) both}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
.hero-eyebrow{
  font-size:9px;font-weight:700;letter-spacing:.18em;text-transform:uppercase;
  color:var(--blue);margin-bottom:10px;display:flex;align-items:center;gap:8px}
.hero-eyebrow::before{content:'';width:18px;height:1px;background:var(--blue)}
.hero-title{font-family:'Syne',sans-serif;font-size:clamp(22px,2.8vw,36px);
  font-weight:800;letter-spacing:-0.05em;line-height:1.05;margin-bottom:5px}
.hero-sub{font-size:13px;color:var(--text3)}
.hero-r{display:flex;align-items:center;gap:10px;flex-shrink:0;flex-wrap:wrap;justify-content:flex-end}

/* ── KPI ROW ── */
.kpi-row{
  display:grid;grid-template-columns:repeat(4,1fr);
  border-bottom:1px solid var(--border);
  animation:fadeUp .40s var(--ease) .05s both}
.kpi{
  padding:24px 22px 22px;border-right:1px solid var(--border);
  position:relative;overflow:hidden;cursor:pointer;
  user-select:none;-webkit-tap-highlight-color:transparent;
  transition:background .15s}
.kpi:last-child{border-right:none}
.kpi::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:var(--kc,var(--blue));opacity:.45;transition:opacity .2s,height .2s}
.kpi:hover{background:rgba(255,255,255,.025)}
.kpi:hover::before{opacity:1;height:3px}
.kpi:active{background:rgba(255,255,255,.05)}
.kpi-val{
  font-family:'JetBrains Mono','Courier New',monospace;
  font-size:clamp(26px,2.6vw,38px);font-weight:700;
  letter-spacing:-0.04em;line-height:1;margin-bottom:9px;color:var(--kc,var(--blue))}
.kpi-lbl{font-size:9px;font-weight:700;letter-spacing:.14em;text-transform:uppercase;color:var(--text3)}
.kpi-bg-icon{position:absolute;bottom:12px;right:14px;opacity:.045;pointer-events:none}

/* ── BENTO GRID ── */
.bento{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  grid-template-rows:auto auto;
  grid-template-areas:
    "profile  analysis  credits"
    "comps    analysis  leads";
  border-bottom:1px solid var(--border);
  animation:fadeUp .42s var(--ease) .1s both}

/* each bento-cell gets a border-right and border-bottom naturally */
.bento-cell{
  border-right:1px solid var(--border);
  border-bottom:1px solid var(--border);
  display:flex;flex-direction:column;overflow:hidden;min-height:300px}
.bento-profile{grid-area:profile}
.bento-analysis{grid-area:analysis;/* spans 2 rows via template-areas */}
.bento-comps{grid-area:comps;border-bottom:none}
.bento-credits{grid-area:credits;border-right:none}
.bento-leads{grid-area:leads;border-right:none;border-bottom:none}

/* ── CELL HEADER ── */
.cell-hd{
  display:flex;align-items:center;justify-content:space-between;gap:8px;
  padding:14px 18px;border-bottom:1px solid var(--border);flex-shrink:0}
.cell-tag{
  font-size:9px;font-weight:700;letter-spacing:.14em;text-transform:uppercase;
  display:flex;align-items:center;gap:7px;color:var(--text2)}
.ctag-bar{width:3px;height:14px;border-radius:2px;flex-shrink:0}
.cell-hd-r{display:flex;gap:6px;align-items:center;flex-shrink:0}

/* ── CELL BODY ── */
.cell-body{padding:16px 18px;flex:1;overflow:auto}
.cb{padding:16px 18px}

/* ── COLLAPSIBLE ── */
.ctog{display:none;width:22px;height:22px;border-radius:2px;border:none;
  background:rgba(255,255,255,.05);color:var(--text3);font-size:12px;
  cursor:pointer;transition:all .18s;align-items:center;justify-content:center;
  flex-shrink:0;font-family:inherit}
.ctog:hover{background:rgba(255,255,255,.1);color:var(--text)}
.ctog.rotated{transform:rotate(180deg)}
.cb.hidden{display:none!important}

/* ── CTA BOX ── */
.cta-box{padding:48px 28px;text-align:center}
.cta-orb{
  width:52px;height:52px;border-radius:4px;margin:0 auto 18px;
  background:rgba(77,166,255,.1);border:1px solid rgba(77,166,255,.2);
  display:flex;align-items:center;justify-content:center;
  animation:floatOrb 4s ease-in-out infinite}
@keyframes floatOrb{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
.cta-box h3{font-family:'Syne',sans-serif;font-size:19px;font-weight:800;
  letter-spacing:-0.03em;margin-bottom:8px}
.cta-box p{color:var(--text2);font-size:13px;line-height:1.7;margin-bottom:22px;
  max-width:320px;margin-left:auto;margin-right:auto}
.cta-btns{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.cta-primary{padding:10px 26px;border-radius:3px;background:var(--blue);color:#000;
  border:none;font-size:13px;font-weight:700;cursor:pointer;font-family:inherit;
  transition:all .18s var(--ease)}
.cta-primary:hover{background:#6ab8ff;transform:translateY(-1px)}
.cta-primary:active{transform:scale(.97)}

/* ── LOADER ── */
.loader-box{padding:48px 24px;text-align:center}
.spin-wrap{width:48px;height:48px;margin:0 auto 22px;position:relative}
.spin-o{position:absolute;inset:0;border-radius:50%;
  border:1.5px solid rgba(77,166,255,.12);border-top-color:var(--blue);animation:spin .85s linear infinite}
.spin-i{position:absolute;top:9px;left:9px;width:30px;height:30px;border-radius:50%;
  border:1.5px solid rgba(192,132,252,.12);border-bottom-color:var(--purple);
  animation:spin .55s linear infinite reverse}
@keyframes spin{to{transform:rotate(360deg)}}
.lstep-txt{font-size:12.5px;font-weight:500;color:var(--text2);margin-bottom:16px;
  min-height:20px;transition:opacity .18s}
.lstep-txt.fade{opacity:0}
.lpw{height:1px;background:rgba(255,255,255,.07);max-width:260px;margin:0 auto 18px;overflow:hidden}
.lpf{height:100%;background:linear-gradient(90deg,var(--blue),var(--purple));
  transition:width .7s var(--ease);width:0}
.loader-steps{display:flex;gap:5px;justify-content:center;flex-wrap:wrap}
.ls{font-size:9px;font-weight:700;padding:3px 9px;border-radius:2px;
  background:rgba(255,255,255,.04);border:1px solid var(--border);
  color:var(--text3);transition:all .28s;letter-spacing:.08em;text-transform:uppercase}
.ls.active{background:rgba(77,166,255,.08);border-color:rgba(77,166,255,.25);color:var(--blue)}
.ls.done{background:rgba(61,214,140,.06);border-color:rgba(61,214,140,.2);color:var(--green)}

/* ── REPORT TABS ── */
#reportBody{padding:0}
.rtabs{display:flex;gap:0;border-bottom:1px solid var(--border);
  overflow-x:auto;scrollbar-width:none;-webkit-overflow-scrolling:touch}
.rtabs::-webkit-scrollbar{display:none}
.rtab{display:flex;align-items:center;gap:5px;padding:11px 13px;
  font-size:9px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;
  color:var(--text3);white-space:nowrap;cursor:pointer;border:none;
  border-bottom:1.5px solid transparent;background:none;margin-bottom:-1px;
  font-family:inherit;transition:color .15s,border-color .15s}
.rtab:hover{color:var(--text2)}
.rtab.on{color:var(--blue);border-bottom-color:var(--blue)}
.rpanel{padding:18px 20px 22px;animation:rpIn .18s var(--ease) both}
@keyframes rpIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}
.slbl{font-size:9px;font-weight:700;letter-spacing:.12em;text-transform:uppercase;
  color:var(--text3);margin:18px 0 8px;display:block}
.slbl:first-child{margin-top:0}
.comp-hero{background:rgba(77,166,255,.04);border:1px solid rgba(77,166,255,.1);
  padding:14px 16px;margin-bottom:12px}
.comp-hero-eyebrow{font-size:9px;font-weight:700;letter-spacing:.12em;text-transform:uppercase;
  color:var(--blue);margin-bottom:8px;display:flex;align-items:center;gap:5px}
.comp-hero-name{font-family:'Syne',sans-serif;font-size:17px;font-weight:800;
  letter-spacing:-0.03em;margin-bottom:3px}
.comp-hero-tag{font-size:11px;color:var(--text3);margin-bottom:10px}
.comp-hero-why{font-size:12.5px;color:var(--text2);line-height:1.7;padding:10px 12px;
  background:rgba(0,0,0,.25);border-left:2px solid rgba(77,166,255,.3)}
.vs-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px}
.vs-card{padding:12px 14px;border:1px solid transparent}
.vs-card.warn{background:rgba(255,179,64,.04);border-color:rgba(255,179,64,.15)}
.vs-card.good{background:rgba(61,214,140,.04);border-color:rgba(61,214,140,.15)}
.vs-card-hd{font-size:9px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;
  margin-bottom:8px;display:flex;align-items:center;gap:5px}
.vs-card.warn .vs-card-hd{color:var(--orange)}
.vs-card.good .vs-card-hd{color:var(--green)}
.vs-item{display:flex;align-items:flex-start;gap:7px;padding:5px 0;
  border-bottom:1px solid rgba(255,255,255,.03)}
.vs-item:last-child{border-bottom:none;padding-bottom:0}
.vs-dot{width:4px;height:4px;border-radius:50%;flex-shrink:0;margin-top:7px}
.vs-card.warn .vs-dot{background:var(--orange)}
.vs-card.good .vs-dot{background:var(--green)}
.vs-item p{font-size:12px;color:var(--text2);line-height:1.6;margin:0}
.block-grid{display:flex;flex-direction:column;gap:8px}
.block-card{display:flex;align-items:flex-start;gap:10px;padding:12px 14px;
  background:rgba(255,90,82,.04);border:1px solid rgba(255,90,82,.1);
  transition:background .15s}
.block-card:hover{background:rgba(255,90,82,.08)}
.block-icon{width:28px;height:28px;flex-shrink:0;
  background:rgba(255,90,82,.1);display:flex;align-items:center;justify-content:center;color:var(--red)}
.block-text{font-size:12px;color:var(--text2);line-height:1.65;padding-top:3px}
.action-list{display:flex;flex-direction:column}
.action-step{display:flex;gap:12px;padding:9px 0;position:relative}
.action-step:not(:last-child)::after{content:'';position:absolute;left:13px;top:36px;
  bottom:0;width:1px;background:rgba(255,255,255,.05)}
.action-num{width:26px;height:26px;flex-shrink:0;background:var(--blue);color:#000;
  display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;z-index:1}
.action-body{padding-top:3px;min-width:0}
.action-text{font-size:12.5px;font-weight:500;color:var(--text2);line-height:1.55}
.kw-toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:11px}
.kw-hint{font-size:11px;color:var(--text3)}
.kw-copy-all{font-size:9px;font-weight:700;padding:4px 11px;border-radius:2px;
  background:rgba(77,166,255,.08);border:1px solid rgba(77,166,255,.18);color:var(--blue);
  cursor:pointer;transition:all .15s;display:inline-flex;align-items:center;gap:5px;
  font-family:inherit;letter-spacing:.08em;text-transform:uppercase}
.kw-copy-all:hover{background:rgba(77,166,255,.18)}
.kw-copy-all.copied{background:rgba(61,214,140,.08);border-color:rgba(61,214,140,.22);color:var(--green)}
.tags{display:flex;flex-wrap:wrap;gap:6px}
.tag{font-size:11.5px;font-weight:500;padding:5px 12px;border-radius:2px;
  background:rgba(77,166,255,.06);border:1px solid rgba(77,166,255,.12);
  color:var(--blue);transition:all .15s;cursor:pointer;user-select:none;
  display:inline-flex;align-items:center;gap:4px}
.tag:hover{background:rgba(77,166,255,.16);border-color:rgba(77,166,255,.28);transform:translateY(-1px)}
.tag:active{transform:scale(.97)}
.tag.copied{background:rgba(61,214,140,.08);border-color:rgba(61,214,140,.24);color:var(--green)}

/* ── PROFILE ── */
.prof-hero{padding:2px 0 12px;border-bottom:1px solid var(--border-m);margin-bottom:11px}
.prof-hero-name{font-family:'Syne',sans-serif;font-size:14px;font-weight:800;
  letter-spacing:-0.03em;margin-bottom:2px}
.prof-hero-meta{font-size:11px;color:var(--text3)}
.prof-pct{display:flex;justify-content:space-between;align-items:center;
  font-size:10px;font-weight:600;color:var(--text3);margin-bottom:5px}
.prof-bar-wrap{height:2px;background:rgba(255,255,255,.05);margin-bottom:13px;overflow:hidden}
.prof-bar{height:100%;background:linear-gradient(90deg,var(--blue),var(--green));
  width:0;transition:width .9s var(--ease)}
.pr{display:flex;justify-content:space-between;align-items:center;gap:10px;
  padding:7px 0;border-bottom:1px solid rgba(255,255,255,.03)}
.pr:last-of-type{border-bottom:none}
.plbl{font-size:10px;color:var(--text3);font-weight:500;flex-shrink:0}
.pval{font-size:12px;font-weight:500;color:var(--text2);text-align:right;
  overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:150px}
.pval.empty{color:var(--text3);font-style:italic}

/* ── COMPETITORS ── */
.ci{display:flex;align-items:center;gap:10px;padding:8px 0;
  border-bottom:1px solid rgba(255,255,255,.03);transition:padding .12s}
.ci:hover{padding-left:4px}
.ci:last-child{border-bottom:none}
.cirk{width:22px;height:22px;flex-shrink:0;font-size:10px;font-weight:700;
  display:flex;align-items:center;justify-content:center;border-radius:2px}
.r1{background:rgba(255,214,10,.12);color:#ffd60a}
.r2{background:rgba(175,175,182,.1);color:#afafb6}
.r3{background:rgba(205,127,50,.1);color:#cd7f32}
.rx{background:rgba(255,255,255,.05);color:var(--text3)}
.ci-name{font-size:12px;font-weight:600;margin-bottom:1px}
.ci-sub{font-size:10px;color:var(--text3)}

/* ── LEADS ── */
.li{padding:9px 0;border-bottom:1px solid rgba(255,255,255,.03);transition:padding .12s}
.li:hover{padding-left:4px}
.li:last-child{border-bottom:none}
.li-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:3px}
.li-name{font-size:12px;font-weight:600}
.li-meta{font-size:10px;color:var(--text3)}
.badge-g{font-size:8px;font-weight:700;padding:2px 7px;border-radius:2px;
  background:rgba(61,214,140,.09);border:1px solid rgba(61,214,140,.2);color:var(--green);
  flex-shrink:0;letter-spacing:.08em;text-transform:uppercase}

/* ── VIEW ALL ── */
.va{display:flex;align-items:center;justify-content:center;gap:5px;
  padding:11px;border-top:1px solid var(--border);
  font-size:9px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;
  color:var(--text3);text-decoration:none;transition:all .15s;flex-shrink:0}
.va-arr{transition:transform .2s var(--ease)}
.va:hover{color:var(--blue);background:rgba(77,166,255,.04)}
.va:hover .va-arr{transform:translateX(3px)}

/* ── EMPTY STATE ── */
.empty{text-align:center;padding:26px 14px}
.ei{margin-bottom:9px;opacity:.2;display:flex;justify-content:center}
.empty p{font-size:11px;color:var(--text3);line-height:1.6}

/* ── USAGE ── */
.usage-feat{display:flex;flex-direction:column;gap:9px}
.usage-row{border:1px solid var(--border);padding:12px 13px;transition:border-color .15s}
.usage-row:hover{border-color:rgba(255,255,255,.1)}
.usage-row-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:7px}
.usage-feat-name{font-size:12px;font-weight:600;display:flex;align-items:center;gap:6px}
.usage-counts{font-size:10.5px;color:var(--text2);font-family:'JetBrains Mono',monospace}
.usage-bar-wrap{height:3px;background:rgba(255,255,255,.05);overflow:hidden}
.usage-bar-fill{height:100%;transition:width .9s var(--ease);width:0}
.usage-tier-badge{display:inline-flex;align-items:center;gap:4px;font-size:9px;
  font-weight:700;padding:2px 8px;border-radius:2px;letter-spacing:.08em;text-transform:uppercase}
.usage-tier-free{background:rgba(255,255,255,.05);color:var(--text3)}
.usage-tier-basic{background:rgba(52,211,153,.07);border:1px solid rgba(52,211,153,.18);color:#34d399}
.usage-tier-pro{background:rgba(77,166,255,.08);border:1px solid rgba(77,166,255,.22);color:var(--blue)}
.usage-tier-enterprise{background:rgba(255,214,10,.08);border:1px solid rgba(255,214,10,.2);color:#ffd60a}
.usage-upgrade-hint{margin-top:11px;padding:10px 12px;
  background:rgba(255,179,64,.05);border:1px solid rgba(255,179,64,.15);
  font-size:11.5px;color:var(--orange);line-height:1.55;
  display:flex;align-items:flex-start;gap:7px}

/* ── PLAN CHIP ── */
.plan-chip{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;
  border-radius:3px;cursor:default;user-select:none}
.plan-chip-free{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);color:var(--text3)}
.plan-chip-basic{background:rgba(52,211,153,.07);border:1px solid rgba(52,211,153,.2);color:#34d399}
.plan-chip-pro{background:rgba(77,166,255,.08);border:1px solid rgba(77,166,255,.25);color:var(--blue)}
.plan-chip-enterprise{background:rgba(255,214,10,.08);border:1px solid rgba(255,214,10,.22);color:#ffd60a}
.plan-chip-icon{flex-shrink:0;display:flex}
.plan-chip-label{display:flex;flex-direction:column;line-height:1.2}
.plan-chip-name{font-family:'Syne',sans-serif;font-size:13px;font-weight:800;letter-spacing:-.01em}
.plan-chip-sub{font-size:9px;font-weight:700;opacity:.45;letter-spacing:.1em;text-transform:uppercase}

/* ── TOAST ── */
.toast{position:fixed;bottom:24px;left:50%;
  transform:translateX(-50%) translateY(10px);
  background:rgba(5,5,10,.97);border:1px solid rgba(255,255,255,.08);
  color:var(--text);font-size:12px;font-weight:500;
  padding:10px 20px;border-radius:3px;
  opacity:0;pointer-events:none;transition:all .26s var(--ease);z-index:9999;
  backdrop-filter:blur(20px);box-shadow:0 8px 32px rgba(0,0,0,.6);white-space:nowrap}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast.ok{border-color:rgba(61,214,140,.3)}
.toast.err{border-color:rgba(255,90,82,.3)}

/* ── RIPPLE ── */
.rpl{position:absolute;border-radius:50%;background:rgba(255,255,255,.08);
  transform:scale(0);animation:rplAnim .45s linear forwards;pointer-events:none}
@keyframes rplAnim{to{transform:scale(4);opacity:0}}

/* ── RESPONSIVE ── */
@media(max-width:960px){
  .bento{
    grid-template-columns:1fr 1fr;
    grid-template-areas:
      "profile  analysis"
      "comps    analysis"
      "credits  leads"}
  .bento-credits{border-right:none}
  .bento-leads{border-right:none;border-bottom:none}
  .bento-comps{border-bottom:1px solid var(--border)}
}
@media(max-width:700px){
  .nav-tabs{display:none}
  .burger{display:flex}
  .nbtn:not(.blue):not(#logoutBtn){display:none}
  .ctog{display:flex}
  .kpi-row{grid-template-columns:1fr 1fr}
  .kpi:nth-child(2){border-right:none}
  .kpi:nth-child(3){border-right:1px solid var(--border)}
  .kpi:nth-child(4){border-right:none}
  .bento{
    grid-template-columns:1fr;
    grid-template-areas:
      "profile"
      "comps"
      "analysis"
      "credits"
      "leads"}
  .bento-cell{border-right:none}
  .bento-comps{border-bottom:1px solid var(--border)}
  .bento-analysis{border-bottom:1px solid var(--border)}
  .bento-credits{border-bottom:1px solid var(--border)}
  .wrap{padding:0 16px 60px}
  .hero{padding:22px 0 18px}
  .vs-grid{grid-template-columns:1fr}
}
@media(max-width:420px){
  .kpi-val{font-size:24px}
  .hero-title{font-size:20px}
  #logoutBtn{display:none}
}
</style>
</head>
<body>
<div id="prog"></div>

<!-- MOBILE DRAWER -->
<div class="mob-drawer" id="mobDrawer">
  <div class="mob-backdrop" onclick="closeMob()"></div>
  <div class="mob-panel">
    <div class="mob-links">
      <a href="dashboard.html" class="mob-link on">Overview</a>
      <a href="competitors.html" class="mob-link">Competitors</a>
      <a href="keywords.html" class="mob-link">Keywords</a>
      <a href="leads.html" class="mob-link">Leads</a>
      <a href="onboard.html" class="mob-link">Edit Profile</a>
    </div>
    <div class="mob-actions">
      <button class="nbtn blue" style="flex:1;padding:9px" onclick="closeMob();runResearch()">Run Analysis →</button>
      <button class="nbtn" id="mobLogout" style="padding:9px 14px">Sign out</button>
    </div>
  </div>
</div>

<!-- NAV -->
<nav class="nav">
  <a href="../index.html" class="logo">
    <div class="logo-mark">
      <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
    </div>
    Biz<em>Boost</em>
  </a>
  <div class="nav-tabs">
    <a href="dashboard.html" class="ntab on">Overview</a>
    <a href="competitors.html" class="ntab">Competitors</a>
    <a href="keywords.html" class="ntab">Keywords</a>
    <a href="leads.html" class="ntab">Leads</a>
  </div>
  <div class="nav-r">
    <div class="nav-avatar" id="navAvatar">?</div>
    <a href="onboard.html" class="nbtn">Edit Profile</a>
    <button class="nbtn" id="logoutBtn">Sign out</button>
    <button class="burger" id="burgerBtn" onclick="toggleMob()" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
  </div>
</nav>

<div class="wrap">

  <!-- HERO -->
  <div class="hero">
    <div class="hero-l">
      <div class="hero-eyebrow">Your Dashboard</div>
      <h1 class="hero-title" id="wTitle">Welcome back</h1>
      <p class="hero-sub" id="wSub">Loading your business…</p>
    </div>
    <div class="hero-r">
      <div id="wTierBadge"></div>
      <button class="nbtn blue" id="topBtn" onclick="runResearch()">Run Analysis →</button>
    </div>
  </div>

  <!-- KPI ROW — 4 perfectly equal columns -->
  <div class="kpi-row">
    <div class="kpi" style="--kc:var(--blue)" onclick="ripple(event,this);jumpTo('bento-analysis-cell')" tabindex="0"
         onkeydown="if(event.key==='Enter')this.click()">
      <div class="kpi-val" id="kpiComp">—</div>
      <div class="kpi-lbl">Competitors</div>
      <div class="kpi-bg-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M6 9H4.5a2.5 2.5 0 010-5H6"/><path d="M18 9h1.5a2.5 2.5 0 000-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.29 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.29 17 22"/><path d="M18 2H6v7a6 6 0 0012 0V2z"/></svg></div>
    </div>
    <div class="kpi" style="--kc:var(--green)" onclick="ripple(event,this);jumpTo('leadsWrap')" tabindex="0"
         onkeydown="if(event.key==='Enter')this.click()">
      <div class="kpi-val" id="kpiLeads">—</div>
      <div class="kpi-lbl">Active Leads</div>
      <div class="kpi-bg-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg></div>
    </div>
    <div class="kpi" style="--kc:var(--purple)" onclick="ripple(event,this);jumpTo('bento-analysis-cell')" tabindex="0"
         onkeydown="if(event.key==='Enter')this.click()">
      <div class="kpi-val" id="kpiKw">—</div>
      <div class="kpi-lbl">Keywords</div>
      <div class="kpi-bg-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 11-7.778 7.778 5.5 5.5 0 017.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg></div>
    </div>
    <div class="kpi" style="--kc:var(--orange)" onclick="ripple(event,this);jumpTo('usageCard')" tabindex="0"
         onkeydown="if(event.key==='Enter')this.click()">
      <div class="kpi-val" id="kpiCredits">—</div>
      <div class="kpi-lbl">Credits Used</div>
      <div class="kpi-bg-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg></div>
    </div>
  </div>

  <!-- BENTO GRID — 3 equal columns, 2 rows -->
  <div class="bento">

    <!-- LEFT-TOP: Business Profile -->
    <div class="bento-cell bento-profile">
      <div class="cell-hd">
        <span class="cell-tag">
          <span class="ctag-bar" style="background:var(--purple)"></span>
          Business Profile
        </span>
        <div class="cell-hd-r">
          <a href="onboard.html" class="nbtn" style="font-size:10px;padding:3px 10px">Edit →</a>
          <button class="ctog" id="togProfile" onclick="toggleCb('profilePanel','togProfile')">▾</button>
        </div>
      </div>
      <div class="cell-body cb" id="profilePanel">
        <div class="empty">
          <div class="ei"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="2" width="6" height="4" rx="1"/><path d="M9 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2h-3"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/></svg></div>
          <p>Loading…</p>
        </div>
      </div>
    </div>

    <!-- MIDDLE: Analysis — spans both rows via grid-template-areas -->
    <div class="bento-cell bento-analysis" id="bento-analysis-cell">

      <!-- Loader (hidden by default) -->
      <div id="loaderBox" style="display:none">
        <div class="loader-box">
          <div class="spin-wrap"><div class="spin-o"></div><div class="spin-i"></div></div>
          <p style="font-size:13px;font-weight:700;font-family:'Syne',sans-serif;letter-spacing:-0.02em;margin-bottom:6px">Analysing your market</p>
          <div class="lstep-txt" id="lstep">Starting up…</div>
          <div class="lpw"><div class="lpf" id="lpf"></div></div>
          <div class="loader-steps">
            <span class="ls" id="ls0">Profile</span>
            <span class="ls" id="ls1">Maps</span>
            <span class="ls" id="ls2">Competitors</span>
            <span class="ls" id="ls3">Scoring</span>
            <span class="ls" id="ls4">AI Strategy</span>
            <span class="ls" id="ls5">Saving</span>
          </div>
          <p style="font-size:9px;color:var(--text3);margin-top:12px;letter-spacing:.06em;text-transform:uppercase">Takes 20–40 seconds</p>
        </div>
      </div>

      <!-- CTA (shown by default) -->
      <div id="ctaBox">
        <div class="cta-box">
          <div class="cta-orb"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg></div>
          <h3>Ready for your strategy?</h3>
          <p>Get a full competitor analysis and AI-powered growth plan for your local market.</p>
          <div class="cta-btns"><button class="cta-primary" onclick="runResearch()">Run Analysis →</button></div>
        </div>
      </div>

      <!-- Report (hidden until analysis runs) -->
      <div id="reportCard" style="display:none">
        <div class="cell-hd">
          <span class="cell-tag">
            <span class="ctag-bar" style="background:var(--blue)"></span>
            Business Analysis
          </span>
          <div class="cell-hd-r">
            <span id="rTime" style="font-size:9px;color:var(--text3)"></span>
            <button onclick="runResearch()" class="nbtn" style="font-size:10px;padding:3px 10px">↻ Re-run</button>
            <button class="ctog" id="togReport" onclick="toggleCb('reportBody','togReport')">▾</button>
          </div>
        </div>
        <div id="reportBody"></div>
      </div>

    </div>

    <!-- RIGHT-TOP: API Credits -->
    <div class="bento-cell bento-credits" id="usageCard">
      <div class="cell-hd">
        <span class="cell-tag">
          <span class="ctag-bar" style="background:var(--orange)"></span>
          API Credits
        </span>
        <div class="cell-hd-r">
          <span id="usageTierBadge"></span>
          <button class="ctog" id="togUsage" onclick="toggleCb('usagePanel','togUsage')">▾</button>
        </div>
      </div>
      <div class="cell-body cb" id="usagePanel">
        <div class="empty"><p>Loading usage…</p></div>
      </div>
    </div>

    <!-- LEFT-BOTTOM: Competitors -->
    <div class="bento-cell bento-comps" id="compCard">
      <div class="cell-hd">
        <span class="cell-tag">
          <span class="ctag-bar" style="background:var(--orange)"></span>
          Top Competitors
        </span>
        <div class="cell-hd-r">
          <span id="compCount" style="font-size:9px;color:var(--text3)"></span>
          <button class="ctog" id="togComp" onclick="toggleCb('compPreview','togComp')">▾</button>
        </div>
      </div>
      <div class="cell-body cb" id="compPreview">
        <div class="empty"><div class="ei"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 010-5H6"/><path d="M18 9h1.5a2.5 2.5 0 000-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.29 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.29 17 22"/><path d="M18 2H6v7a6 6 0 0012 0V2z"/></svg></div><p>Run analysis to discover competitors.</p></div>
      </div>
      <a href="competitors.html" class="va">View all competitors <span class="va-arr">→</span></a>
    </div>

    <!-- RIGHT-BOTTOM: Buyer Leads -->
    <div class="bento-cell bento-leads" id="leadsWrap">
      <div class="cell-hd">
        <span class="cell-tag">
          <span class="ctag-bar" style="background:var(--green)"></span>
          Buyer Leads
        </span>
        <div class="cell-hd-r">
          <span id="leadsSub" style="font-size:9px;color:var(--text3)"></span>
          <button class="ctog" id="togLeads" onclick="toggleCb('leadsPreview','togLeads')">▾</button>
        </div>
      </div>
      <div class="cell-body cb" id="leadsPreview">
        <div class="empty"><div class="ei"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg></div><p>No leads yet.</p></div>
      </div>
      <a href="leads.html" class="va">View all leads <span class="va-arr">→</span></a>
    </div>

  </div><!-- /bento -->

</div><!-- /wrap -->

<div class="toast" id="toast"></div>

<script>
// ── SVG ICON HELPER ──────────────────────────────────────────
const ICONS={
  'bar-chart':'<line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/>',
  'storefront':'<rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V11a4 4 0 00-8 0v10"/><path d="M2 7l2-5h16l2 5"/>',
  'trophy':'<path d="M6 9H4.5a2.5 2.5 0 010-5H6"/><path d="M18 9h1.5a2.5 2.5 0 000-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.29 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.29 17 22"/><path d="M18 2H6v7a6 6 0 0012 0V2z"/>',
  'package':'<line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/>',
  'key':'<path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 11-7.778 7.778 5.5 5.5 0 017.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/>',
  'credit-card':'<rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/>',
  'phone':'<path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 9.8a19.79 19.79 0 01-3.07-8.63A2 2 0 012 .82h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L6.09 8.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/>',
  'star':'<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>',
  'map-pin':'<path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/>',
  'dollar-sign':'<line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/>',
  'zap':'<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>',
  'alert-triangle':'<path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>',
  'clipboard':'<rect x="9" y="2" width="6" height="4" rx="1" ry="1"/><path d="M9 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2h-3"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/>',
  'check-circle':'<path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>',
  'check':'<polyline points="20 6 9 17 4 12"/>',
  'x-circle':'<circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>',
  'layout-grid':'<rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>',
  'compass':'<circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/>',
  'search':'<circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>',
  'inbox':'<polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11L2 12v6a2 2 0 002 2h16a2 2 0 002-2v-6l-3.45-6.89A2 2 0 0016.76 4H7.24a2 2 0 00-1.79 1.11z"/>',
  'edit-2':'<path d="M17 3a2.828 2.828 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>',
  'list':'<line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/>',
  'trending-up':'<polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/>',
  'robot':'<rect x="3" y="11" width="18" height="10" rx="2"/><path d="M12 3a2 2 0 00-2 2v6h4V5a2 2 0 00-2-2z"/><line x1="8" y1="16" x2="8.01" y2="16"/><line x1="16" y1="16" x2="16.01" y2="16"/>',
  'refresh-cw':'<path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>',
  'gem':'<polygon points="6 3 18 3 22 9 12 22 2 9"/><polyline points="2 9 6 3 12 9 18 3 22 9"/><line x1="12" y1="22" x2="12" y2="9"/>',
  'circle':'<circle cx="12" cy="12" r="10"/>',
  'crown':'<path d="M2 4l3 12h14l3-12-6 7-4-7-4 7-6-7z"/><path d="M5 20h14"/>',
};
function icon(name,size=16){
  return `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block;vertical-align:middle;flex-shrink:0">${ICONS[name]||''}</svg>`;
}

const API="/api";
let seller=JSON.parse(localStorage.getItem("seller")||"null");
let details=JSON.parse(localStorage.getItem("sellerDetails")||"{}");
if(!seller?.id)location.href="register.html";

/* SCROLL PROGRESS */
window.addEventListener("scroll",()=>{
  const s=window.scrollY,h=document.documentElement.scrollHeight-innerHeight;
  if(h>0)document.getElementById("prog").style.width=(s/h*100)+"%";
},{passive:true});

/* RIPPLE */
function ripple(e,el){
  const r=document.createElement("span"),rect=el.getBoundingClientRect();
  const sz=Math.max(rect.width,rect.height);
  r.className="rpl";
  r.style.cssText=`width:${sz}px;height:${sz}px;left:${e.clientX-rect.left-sz/2}px;top:${e.clientY-rect.top-sz/2}px`;
  el.appendChild(r);r.addEventListener("animationend",()=>r.remove());
}

/* JUMP TO SECTION */
function jumpTo(id){
  const el=document.getElementById(id);
  if(!el||el.style.display==="none")return;
  el.scrollIntoView({behavior:"smooth",block:"start"});
  const orig=el.style.outline;
  el.style.transition="outline .3s";
  el.style.outline="1px solid rgba(77,166,255,.4)";
  setTimeout(()=>{el.style.outline=orig||""},1100);
}

/* MOBILE NAV */
function toggleMob(){
  const d=document.getElementById("mobDrawer"),b=document.getElementById("burgerBtn");
  d.classList.toggle("open");b.classList.toggle("open");
  document.body.style.overflow=d.classList.contains("open")?"hidden":"";
}
function closeMob(){
  document.getElementById("mobDrawer").classList.remove("open");
  document.getElementById("burgerBtn").classList.remove("open");
  document.body.style.overflow="";
}

/* COLLAPSIBLE */
function toggleCb(cbId,btnId){
  const cb=document.getElementById(cbId),btn=document.getElementById(btnId);
  cb.classList.toggle("hidden");btn.classList.toggle("rotated");
}

/* TOAST */
let _toastTid;
function toast(msg,dur=3500,type=""){
  const t=document.getElementById("toast");
  t.innerHTML=msg;t.className="toast show"+(type?" "+type:"");
  clearTimeout(_toastTid);
  _toastTid=setTimeout(()=>t.classList.remove("show"),dur);
}

/* ANIMATED COUNTER */
function animCount(el,target){
  if(!el)return;
  const n=parseInt(target)||0;
  if(n===0){el.textContent="0";return}
  let cur=0;const dur=700,frames=40,inc=n/frames;
  const t=setInterval(()=>{
    cur=Math.min(cur+inc,n);el.textContent=Math.round(cur);
    if(cur>=n)clearInterval(t);
  },dur/frames);
}

function esc(s){return(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}

/* AUTH */
function doLogout(){localStorage.clear();location.href="../index.html"}
document.getElementById("logoutBtn").addEventListener("click",doLogout);
document.getElementById("mobLogout").addEventListener("click",doLogout);

/* WELCOME */
function initWelcome(){
  seller=JSON.parse(localStorage.getItem("seller")||"{}");
  details=JSON.parse(localStorage.getItem("sellerDetails")||"{}");
  const name=seller.name?.split(" ")[0]||"there";
  document.getElementById("wTitle").textContent="Welcome back, "+name;
  document.getElementById("wSub").textContent=
    [(seller.city||""),(seller.state||"")].filter(Boolean).join(", ")+(seller.category?" · "+seller.category:"");
  const av=document.getElementById("navAvatar");
  if(av)av.textContent=(seller.name||"?").charAt(0).toUpperCase();
}
initWelcome();

/* PROFILE */
function renderProfile(){
  seller=JSON.parse(localStorage.getItem("seller")||"{}");
  details=JSON.parse(localStorage.getItem("sellerDetails")||"{}");
  const allRows=[
    ["Business",seller.name],["Category",seller.category],["Type",details.business_type],
    ["City",seller.city],["State",seller.state],["Phone",seller.contact],
    ["GST",details.gst_number],["Employees",details.employees],
    ["Turnover",details.annual_turnover],["Website",seller.website],
  ];
  const filled=allRows.filter(r=>r[1]).length;
  const pct=Math.round(filled/allRows.length*100);
  const pctColor=pct<60?"var(--orange)":"var(--green)";

  let h=`<div class="prof-hero">
    <div class="prof-hero-name">${esc(seller.name||"Your Business")}</div>
    <div class="prof-hero-meta">${[seller.category,seller.city,seller.state].filter(Boolean).join(" · ")||"No details yet"}</div>
  </div>
  <div class="prof-pct">
    <span>Profile completeness</span>
    <span style="color:${pctColor};font-weight:700">${pct}%</span>
  </div>
  <div class="prof-bar-wrap"><div class="prof-bar" id="profBar"></div></div>`;

  const keyFields=[["Phone",seller.contact],["Website",seller.website],["Employees",details.employees],["Turnover",details.annual_turnover]].filter(([,v])=>v).slice(0,3);
  keyFields.forEach(([l,v])=>{
    h+=`<div class="pr"><span class="plbl">${esc(l)}</span><span class="pval">${esc(v)}</span></div>`;
  });
  if(!keyFields.length&&pct<40){
    h+=`<div class="pr"><span class="plbl">Type</span><span class="pval empty">${esc(details.business_type||"Not added")}</span></div>`;
  }
  if(pct<60){
    h+=`<div style="margin-top:11px;background:rgba(255,179,64,.06);
        border:1px solid rgba(255,179,64,.15);
        padding:9px 11px;font-size:11px;color:var(--orange);line-height:1.55;display:flex;align-items:center;gap:7px">
      ${icon('alert-triangle',12)} <span>Add more details for better analysis. <a href="onboard.html" style="color:var(--orange);font-weight:700">Complete →</a></span>
    </div>`;
  }
  document.getElementById("profilePanel").innerHTML=h;
  setTimeout(()=>{const b=document.getElementById("profBar");if(b)b.style.width=pct+"%"},120);
}
renderProfile();

/* COMPETITORS */
function renderCompPreview(comps){
  const card=document.getElementById("compCard");
  const preview=document.getElementById("compPreview");
  if(!comps?.length){
    card.style.display="";
    return;
  }
  card.style.display="";
  document.getElementById("compCount").textContent=comps.length+" found";
  preview.innerHTML=comps.slice(0,5).map((c,i)=>{
    const cls=["r1","r2","r3","rx","rx"][i]||"rx";
    return `<div class="ci">
      <div class="cirk ${cls}">${i+1}</div>
      <div style="min-width:0">
        <div class="ci-name">${esc(c.name)}</div>
        <div class="ci-sub">${c.rating?`${icon('star',10)} ${c.rating} (${c.reviews})`:""} ${c.phone?`· ${icon('phone',10)} ${esc(c.phone)}`:""}</div>
      </div>
    </div>`;
  }).join("");
}

/* LEADS */
async function loadLeads(){
  try{
    const s=JSON.parse(localStorage.getItem("seller")||"{}");
    const r=await fetch(`${API}/get_leads.php?seller_id=${s.id}&category=${encodeURIComponent(s.category||"")}&city=${encodeURIComponent(s.city||"")}`);
    const d=await r.json();
    if(!d.success||!d.leads?.length){document.getElementById("leadsSub").textContent="No leads yet";return}
    animCount(document.getElementById("kpiLeads"),d.leads.length);
    document.getElementById("leadsSub").textContent=d.leads.length+" active";
    document.getElementById("leadsPreview").innerHTML=d.leads.slice(0,3).map(l=>`
      <div class="li">
        <div class="li-top">
          <span class="li-name">${esc(l.product)}</span>
          <span class="badge-g">Active</span>
        </div>
        <div class="li-meta">${icon('map-pin',10)} ${esc(l.city)} · ${icon('dollar-sign',10)} ${l.budget_max>0?`₹${Number(l.budget_min).toLocaleString("en-IN")}–₹${Number(l.budget_max).toLocaleString("en-IN")}`:"Budget N/A"}</div>
      </div>`).join("");
  }catch(e){}
}
loadLeads();

/* COPY TAG */
function copyTag(el,text){
  navigator.clipboard?.writeText(text).then(()=>{
    const orig=el.innerHTML;
    el.classList.add("copied");el.innerHTML=icon('check',12)+' Copied';
    setTimeout(()=>{el.classList.remove("copied");el.innerHTML=orig},1800);
  }).catch(()=>toast("Clipboard not available",2000));
}

/* REPORT */
let _kwList=[];

function switchRTab(id){
  document.querySelectorAll('.rtab').forEach(t=>t.classList.toggle('on',t.dataset.tab===id));
  document.querySelectorAll('.rpanel').forEach(p=>{p.style.display=p.dataset.panel===id?'':'none'});
}

function copyAllKeywords(el){
  const text=_kwList.join(', ');
  navigator.clipboard?.writeText(text).then(()=>{
    const orig=el.innerHTML;
    el.classList.add('copied');el.innerHTML=icon('check',12)+' All copied!';
    setTimeout(()=>{el.classList.remove('copied');el.innerHTML=orig},2000);
  }).catch(()=>toast("Clipboard not available",2000));
}

function renderReport(s){
  if(!s)return;
  document.getElementById("reportCard").style.display="block";
  document.getElementById("ctaBox").style.display="none";
  _kwList=s.keyword_targets||[];
  const tc=s.top_competitor;
  const tabs=[];const panels={};

  if(tc?.name){
    tabs.push({id:'comp',icon:'trophy',label:'Competitor'});
    let h=`<div class="comp-hero">
      <div class="comp-hero-eyebrow">${icon('trophy',10)} Top Local Competitor</div>
      <div class="comp-hero-name">${esc(tc.name)}</div>
      <div class="comp-hero-tag">Currently winning your local market</div>
      ${tc.why_winning?`<div class="comp-hero-why">${esc(tc.why_winning)}</div>`:''}
    </div>`;
    const hasStr=(tc.their_strengths||[]).length;
    const hasBeat=(tc.how_to_beat_them||[]).length;
    if(hasStr||hasBeat){
      h+=`<div class="vs-grid">`;
      if(hasStr){
        h+=`<div class="vs-card warn"><div class="vs-card-hd">${icon('zap',10)} Their Edge</div>`;
        h+=tc.their_strengths.map(t=>`<div class="vs-item"><div class="vs-dot"></div><p>${esc(t)}</p></div>`).join("");
        h+=`</div>`;
      }
      if(hasBeat){
        h+=`<div class="vs-card good"><div class="vs-card-hd">${icon('compass',10)} How to Win</div>`;
        h+=tc.how_to_beat_them.map(t=>`<div class="vs-item"><div class="vs-dot"></div><p>${esc(t)}</p></div>`).join("");
        h+=`</div>`;
      }
      h+=`</div>`;
    }
    panels['comp']=h;
  }

  if((s.bottlenecks||[]).length){
    tabs.push({id:'block',icon:'alert-triangle',label:'Blockers'});
    panels['block']='<div class="block-grid">'+s.bottlenecks.map(b=>
      `<div class="block-card"><div class="block-icon">${icon('alert-triangle',15)}</div><p class="block-text">${esc(b)}</p></div>`
    ).join("")+'</div>';
  }

  if((s.weekly_actions||[]).length){
    tabs.push({id:'act',icon:'list',label:'Actions'});
    panels['act']='<div class="action-list">'+s.weekly_actions.map((a,i)=>
      `<div class="action-step">
        <div class="action-num">${i+1}</div>
        <div class="action-body"><p class="action-text">${esc(a)}</p></div>
      </div>`
    ).join("")+'</div>';
  }

  if(_kwList.length){
    tabs.push({id:'kw',icon:'key',label:'Keywords'});
    panels['kw']=`<div class="kw-toolbar">
      <span class="kw-hint">${_kwList.length} targets — tap to copy</span>
      <button class="kw-copy-all" onclick="copyAllKeywords(this)">${icon('clipboard',11)} Copy all</button>
    </div>
    <div class="tags">`+_kwList.map(k=>`<span class="tag" onclick="copyTag(this,'${esc(k)}')">${esc(k)}</span>`).join("")+`</div>`;
  }

  if(!tabs.length){
    document.getElementById("reportBody").innerHTML=`<div class="empty" style="padding:28px"><div class="ei">${icon('robot',26)}</div><p>Re-run analysis to generate strategy.</p></div>`;
    return;
  }

  const firstId=tabs[0].id;
  let html='<div class="rtabs">';
  html+=tabs.map(t=>`<button class="rtab${t.id===firstId?' on':''}" data-tab="${t.id}" onclick="switchRTab('${t.id}')">${icon(t.icon,10)} ${t.label}</button>`).join("");
  html+='</div>';
  html+=tabs.map(t=>`<div class="rpanel" data-panel="${t.id}"${t.id!==firstId?' style="display:none"':''}>${panels[t.id]||''}</div>`).join("");
  document.getElementById("reportBody").innerHTML=html;
}

/* LOADER STEP FADE */
function setStep(txt){
  const el=document.getElementById("lstep");
  el.classList.add("fade");
  setTimeout(()=>{el.textContent=txt;el.classList.remove("fade")},180);
}

/* RUN ANALYSIS */
async function runResearch(){
  seller=JSON.parse(localStorage.getItem("seller")||"null");
  if(!seller)location.href="register.html";
  document.getElementById("ctaBox").style.display="none";
  document.getElementById("reportCard").style.display="none";
  document.getElementById("loaderBox").style.display="block";
  document.getElementById("topBtn").disabled=true;
  const lsEls=["ls0","ls1","ls2","ls3","ls4","ls5"];
  lsEls.forEach(id=>{const e=document.getElementById(id);if(e)e.className="ls"});
  document.getElementById("lpf").style.width="0";

  const det=JSON.parse(localStorage.getItem("sellerDetails")||"{}");
  const prod1=(det.products_offered||"").split(",")[0]?.trim()||"your products";
  const steps=[
    [10,"Reading business profile…"],
    [22,`Searching Maps for "${prod1}"…`],
    [38,"Finding local competitors…"],
    [54,"Scoring and ranking…"],
    [68,"Building AI prompt…"],
    [82,"Groq AI generating plan…"],
    [94,"Saving report…"],
  ];
  let si=0;
  const tick=setInterval(()=>{
    if(si<steps.length){
      setStep(steps[si][1]);
      document.getElementById("lpf").style.width=steps[si][0]+"%";
      if(si>0){const p=document.getElementById(lsEls[si-1]);if(p){p.classList.remove("active");p.classList.add("done")}}
      const cur=document.getElementById(lsEls[si]);if(cur)cur.classList.add("active");
      si++;
    }
  },3200);

  try{
    const res=await fetch(`${API}/seller_research.php`,{method:"POST",
      headers:{"Content-Type":"application/json"},body:JSON.stringify({seller_id:seller.id})});
    const text=await res.text();
    clearInterval(tick);
    document.getElementById("lpf").style.width="100%";
    lsEls.forEach(id=>{const e=document.getElementById(id);if(e){e.classList.remove("active");e.classList.add("done")}});
    if(!res.ok)throw new Error(`HTTP ${res.status}: ${text.substring(0,100)}`);
    let data;try{data=JSON.parse(text)}catch(e){throw new Error("Non-JSON: "+text.substring(0,150))}
    if(!data.success)throw new Error(data.error||"Analysis failed");
    if(!data.strategy||!Object.keys(data.strategy).length)throw new Error("Empty strategy.");
    const now=new Date().toLocaleString("en-IN",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});
    localStorage.setItem("lastReport",JSON.stringify({strategy:data.strategy,competitors:data.competitors,top_competitor:data.top_competitor,timestamp:now}));
    animCount(document.getElementById("kpiComp"),data.counts?.competitors||(data.competitors||[]).length);
    animCount(document.getElementById("kpiKw"),data.counts?.keywords||(data.strategy.keyword_targets||[]).length);
    document.getElementById("rTime").textContent="Last run: "+now;
    renderReport(data.strategy);
    renderCompPreview(data.competitors||[]);
    toast(`${icon('check-circle',13)} Analysis complete!`,3500,"ok");
    loadUsage();
  }catch(err){
    clearInterval(tick);
    document.getElementById("loaderBox").style.display="none";
    document.getElementById("ctaBox").style.display="block";
    document.getElementById("ctaBox").innerHTML=`<div class="cta-box">
      <div class="cta-orb" style="background:rgba(255,90,82,.1);border-color:rgba(255,90,82,.2);animation:none">${icon('alert-triangle',22)}</div>
      <h3>Analysis Failed</h3>
      <p style="color:var(--red)">${esc(err.message)}</p>
      <div class="cta-btns"><button class="cta-primary" onclick="runResearch()">Retry →</button></div>
    </div>`;
    toast(`${icon('x-circle',13)} `+esc(err.message),6000,"err");
  }finally{
    document.getElementById("loaderBox").style.display="none";
    document.getElementById("topBtn").disabled=false;
  }
}

/* USAGE */
async function loadUsage(){
  const s=JSON.parse(localStorage.getItem("seller")||"{}");
  if(!s.id)return;
  try{
    const r=await fetch(`${API}/seller-usage.php?seller_id=${s.id}`);
    const d=await r.json();
    if(!d.success)return;
    renderUsage(d);
  }catch(e){}
}

function renderUsage(d){
  const tier=d.tier||"free";
  const limits=d.limits||{free:2,basic:10,pro:30,enterprise:-1};
  const usage=d.usage||[];
  const limit=limits[tier];
  const tierLabels={free:"Free",basic:"Basic",pro:"Pro",enterprise:"Enterprise"};
  const tierBadgeClass={free:"usage-tier-free",basic:"usage-tier-basic",pro:"usage-tier-pro",enterprise:"usage-tier-enterprise"};
  const tierIcons={free:icon('circle',11),basic:icon('circle',11),pro:icon('gem',11),enterprise:icon('crown',11)};
  const chipIcons={free:icon('circle',16),basic:icon('zap',16),pro:icon('gem',16),enterprise:icon('crown',16)};
  const chipClass={free:"plan-chip-free",basic:"plan-chip-basic",pro:"plan-chip-pro",enterprise:"plan-chip-enterprise"};

  const badgeEl=document.getElementById("usageTierBadge");
  const wTierEl=document.getElementById("wTierBadge");
  const badgeHtml=`<span class="usage-tier-badge ${tierBadgeClass[tier]||'usage-tier-free'}">${tierIcons[tier]||''} ${tierLabels[tier]||tier}</span>`;
  if(badgeEl)badgeEl.innerHTML=badgeHtml;
  if(wTierEl)wTierEl.innerHTML=`<div class="plan-chip ${chipClass[tier]||'plan-chip-free'}">
    <span class="plan-chip-icon">${chipIcons[tier]||chipIcons.free}</span>
    <span class="plan-chip-label">
      <span class="plan-chip-name">${tierLabels[tier]||tier}</span>
      <span class="plan-chip-sub">Current Plan</span>
    </span>
  </div>`;

  const featureNames={analyze:`${icon('search',12)} Analyze`,competitor_intel:`${icon('compass',12)} Competitor Intel`};
  const features=["analyze","competitor_intel"];
  let totalUsedThisMonth=0;
  let totalLimit=0;

  let html='<div class="usage-feat">';
  features.forEach(feat=>{
    const row=usage.find(u=>u.feature===feat)||{this_month:0,total:0};
    const used=parseInt(row.this_month||0);
    totalUsedThisMonth+=used;
    const pct=limit&&limit!==-1?Math.min(100,Math.round(used/limit*100)):0;
    const barColor=pct>=100?"var(--red)":pct>=80?"var(--orange)":"var(--blue)";
    if(limit!==-1)totalLimit+=limit;
    html+=`<div class="usage-row">
      <div class="usage-row-top">
        <span class="usage-feat-name">${featureNames[feat]||feat}</span>
        <span class="usage-counts">${used}${limit&&limit!==-1?" / "+limit:""} this month</span>
      </div>
      ${limit&&limit!==-1?`<div class="usage-bar-wrap"><div class="usage-bar-fill" id="ubar-${feat}" style="background:${barColor};width:0%"></div></div>`
        :`<div style="font-size:10px;color:var(--green);display:flex;align-items:center;gap:5px">${icon('check-circle',10)} Unlimited</div>`}
      <div style="margin-top:5px;font-size:10px;color:var(--text3)">${row.total||0} total all-time</div>
    </div>`;
  });
  html+='</div>';

  if(limit&&limit!==-1&&totalLimit>0){
    const overallPct=Math.round(totalUsedThisMonth/totalLimit*100);
    if(overallPct>=80){
      html+=`<div class="usage-upgrade-hint">${icon('alert-triangle',13)}<div>You've used <strong>${overallPct}%</strong> of your monthly credits. ${overallPct>=100?'<strong>Upgrade to continue.</strong>':'Consider upgrading for more.'}</div></div>`;
    }
  }

  document.getElementById("usagePanel").innerHTML=html;

  setTimeout(()=>{
    features.forEach(feat=>{
      const row=usage.find(u=>u.feature===feat)||{this_month:0,total:0};
      const used=parseInt(row.this_month||0);
      const pct=limit&&limit!==-1?Math.min(100,Math.round(used/limit*100)):0;
      const el=document.getElementById("ubar-"+feat);
      if(el)el.style.width=pct+"%";
    });
  },80);

  animCount(document.getElementById("kpiCredits"),totalUsedThisMonth);
}

/* INIT */
window.addEventListener("DOMContentLoaded",()=>{
  const p=new URLSearchParams(location.search);
  if(p.get("analyse")==="1"){
    history.replaceState({},"","dashboard.html");
    localStorage.removeItem("lastReport");
    initWelcome();renderProfile();
    toast(`${icon('check-circle',13)} Profile saved — running analysis…`,3000,"ok");
    setTimeout(runResearch,800);
  }else{
    const cached=JSON.parse(localStorage.getItem("lastReport")||"null");
    if(cached?.strategy){
      renderReport(cached.strategy);
      renderCompPreview(cached.competitors||[]);
      animCount(document.getElementById("kpiComp"),(cached.competitors||[]).length);
      animCount(document.getElementById("kpiKw"),(cached.strategy.keyword_targets||[]).length);
      if(cached.timestamp)document.getElementById("rTime").textContent="Last run: "+cached.timestamp;
    }
  }
  loadUsage();
});
</script>
</body>
</html>
